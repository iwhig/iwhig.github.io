<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="2023 云计算技能大赛-私有云, IW&#39;S BLOG">
    <meta name="description" content="2022年云计算技能大赛私有云场，记录了本次比赛所有赛题以及解答">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>2023 云计算技能大赛-私有云 | IW&#39;S BLOG</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">IW&#39;S BLOG</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="https://iwhig.github.io/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="https://cloudzzjm-my.sharepoint.com/" class="waves-effect waves-light">
      
      <i class="far fa-hdd" style="zoom: 0.6;"></i>
      
      <span>Cloud</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">IW&#39;S BLOG</div>
        <div class="logo-desc">
            
            当你的能力还驾驭不了你的目标时，就应该沉下心来，历练
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="https://iwhig.github.io/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="https://cloudzzjm-my.sharepoint.com/" class="waves-effect waves-light">
			
			    <i class="fa-fw far fa-hdd"></i>
			
			Cloud
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = 'd7efd0effc358c795886dbe41681c9590cf3082b5fc3e21857f34a34c63f725b';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">2023 云计算技能大赛-私有云</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                            <a href="/tags/Ansible/">
                                <span class="chip bg-color">Ansible</span>
                            </a>
                        
                            <a href="/tags/Openstack/">
                                <span class="chip bg-color">Openstack</span>
                            </a>
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                            <a href="/tags/SQL/">
                                <span class="chip bg-color">SQL</span>
                            </a>
                        
                            <a href="/tags/Elasticsearch/">
                                <span class="chip bg-color">Elasticsearch</span>
                            </a>
                        
                            <a href="/tags/Jumpserver/">
                                <span class="chip bg-color">Jumpserver</span>
                            </a>
                        
                            <a href="/tags/Redis/">
                                <span class="chip bg-color">Redis</span>
                            </a>
                        
                            <a href="/tags/Skywalking/">
                                <span class="chip bg-color">Skywalking</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CloudComputing/" class="post-category">
                                CloudComputing
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-03-10
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-03-06
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    17.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    87 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="【任务-1】私有云服务搭建-10-分"><a href="#【任务-1】私有云服务搭建-10-分" class="headerlink" title="【任务 1】私有云服务搭建[10 分]"></a>【任务 1】私有云服务搭建[10 分]</h2><h3 id="【题目-1】基础环境配置-0-5-分"><a href="#【题目-1】基础环境配置-0-5-分" class="headerlink" title="【题目 1】基础环境配置[0.5 分]"></a>【题目 1】基础环境配置[0.5 分]</h3><p>使用提供的用户名密码，登录提供的 OpenStack 私有云平台，在当前租户下，使用CentOS7.9 镜像，创建两台云主机，云主机类型使用 4vCPU/12G/100G_50G 类型。当前租户下默认存在一张网卡，自行创建第二张网卡并连接至 controller 和 compute 节点（第二张网卡的网段为 10.10.X.0/24，X 为工位号，不需要创建路由）。自行检查安全组策略，以确保网络正常通信与 ssh 连接，然后按以下要求配置服务器：<br>（1）设置控制节点主机名为 controller，设置计算节点主机名为 compute；<br>（2）修改hosts 文件将 IP 地址映射为主机名；<br>完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname controller</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname compute</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
<span class="token number">192.168</span>.100.10 controller
<span class="token number">192.168</span>.100.20 compute
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.查看控制节点名字为 controller 正确计 0.2 分<br>2.查看 hosts 文件中有正确的主机名和 IP 映射计 0.2 分<br>3.控制节点正确使用两块网卡计 0.1 分</p>
<h3 id="【题目-2】Yum-源配置-0-5-分"><a href="#【题目-2】Yum-源配置-0-5-分" class="headerlink" title="【题目 2】Yum 源配置[0.5 分]"></a>【题目 2】Yum 源配置[0.5 分]</h3><p>使用提供的 http 服务地址，在 http 服务下，存在 centos7.9 和 iaas 的网络 yum 源，使用该 http 源作为安装 iaas 平台的网络源。分别设置 controller 节点和 compute 节点的 yum 源文件 http.repo。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.repos.d/local.repo</span>
<span class="token punctuation">[</span>centos<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>centos
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/centos  <span class="token comment">#比赛使用的是http远程yum源</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>iaas<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>iaas
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/iaas/iaas-repo
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.查看/etc/yum.repos.d/http.repo 文件，有正确的 baseurl  路径，计 0.5 分</p>
<h3 id="【题目-3】配置无秘钥-ssh-0-5-分"><a href="#【题目-3】配置无秘钥-ssh-0-5-分" class="headerlink" title="【题目 3】配置无秘钥 ssh[0.5 分]"></a>【题目 3】配置无秘钥 ssh[0.5 分]</h3><p>配置 controller 节点可以无秘钥访问 compute 节点，配置完成后，尝试 ssh 连接 compute<br>节点的 hostname 进行测试。完成后提交 controller 节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ssh compute</span>
Last login: Sun Sep <span class="token number">20</span> <span class="token number">23</span>:40:30 <span class="token number">2022</span> from <span class="token number">192.168</span>.100.1
 <span class="token comment">################################</span>
 <span class="token comment">#    Welcome  to  OpenStack    #</span>
 <span class="token comment">################################</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># ssh controller</span>
Last login: Sun Sep <span class="token number">20</span> <span class="token number">23</span>:39:59 <span class="token number">2022</span> from <span class="token number">192.168</span>.100.1
 <span class="token comment">################################</span>
 <span class="token comment">#    Welcome  to  OpenStack    #</span>
 <span class="token comment">################################</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>

<p>1.查看控制节点允许计算节点无秘钥登录计 0.5 分</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>【题目 4】基础安装[0.5 分]<br>在控制节点和计算节点上分别安装 openstack-iaas 软件包，根据表 2 配置两个节点脚本文件中的基本变量（配置脚本文件为/etc/openstack/openrc.sh）。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install -y openstack-iaas</span>
Loaded plugins: fastestmirror
Determining fastest mirrors
centos                                                                                           <span class="token operator">|</span> <span class="token number">3.6</span> kB  00:00:00
iaas                                                                                             <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
Package openstack-iaas-2.0.1-2.noarch already installed and latest version
Nothing to <span class="token keyword">do</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/^.//'g /etc/openstack/openrc.sh</span>
<span class="token comment">#去点第一行的注释符</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/PASS=/PASS=000000/'g /etc/openstack/openrc.sh</span>
<span class="token comment">#替换PASS=为PASS=000000</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/openstack/openrc.sh</span>
<span class="token comment">#--------------------system Config--------------------##</span>
<span class="token comment">#Controller Server Manager IP. example:x.x.x.x</span>
<span class="token assign-left variable">HOST_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.100.10

<span class="token comment">#Controller HOST Password. example:000000</span>
<span class="token assign-left variable">HOST_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#Controller Server hostname. example:controller</span>
<span class="token assign-left variable">HOST_NAME</span><span class="token operator">=</span>controller

<span class="token comment">#Compute Node Manager IP. example:x.x.x.x</span>
<span class="token assign-left variable">HOST_IP_NODE</span><span class="token operator">=</span><span class="token number">192.168</span>.100.20

<span class="token comment">#Compute HOST Password. example:000000</span>
<span class="token assign-left variable">HOST_PASS_NODE</span><span class="token operator">=</span>000000

<span class="token comment">#Compute Node hostname. example:compute</span>
<span class="token assign-left variable">HOST_NAME_NODE</span><span class="token operator">=</span>compute

<span class="token comment">#--------------------Chrony Config-------------------##</span>
<span class="token comment">#Controller network segment IP.  example:x.x.0.0/16(x.x.x.0/24)</span>
<span class="token assign-left variable">network_segment_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.100.0/24

<span class="token comment">#--------------------Rabbit Config ------------------##</span>
<span class="token comment">#user for rabbit. example:openstack</span>
<span class="token assign-left variable">RABBIT_USER</span><span class="token operator">=</span>openstack

<span class="token comment">#Password for rabbit user .example:000000</span>
<span class="token assign-left variable">RABBIT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------MySQL Config---------------------##</span>
<span class="token comment">#Password for MySQL root user . exmaple:000000</span>
<span class="token assign-left variable">DB_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Keystone Config------------------##</span>
<span class="token comment">#Password for Keystore admin user. exmaple:000000</span>
<span class="token assign-left variable">DOMAIN_NAME</span><span class="token operator">=</span>default
<span class="token assign-left variable">ADMIN_PASS</span><span class="token operator">=</span>000000
<span class="token assign-left variable">DEMO_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Mysql keystore user. exmaple:000000</span>
<span class="token assign-left variable">KEYSTONE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Glance Config--------------------##</span>
<span class="token comment">#Password for Mysql glance user. exmaple:000000</span>
<span class="token assign-left variable">GLANCE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore glance user. exmaple:000000</span>
<span class="token assign-left variable">GLANCE_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Placement Config----------------------##</span>
<span class="token comment">#Password for Mysql placement user. exmaple:000000</span>
<span class="token assign-left variable">PLACEMENT_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore placement user. exmaple:000000</span>
<span class="token assign-left variable">PLACEMENT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Nova Config----------------------##</span>
<span class="token comment">#Password for Mysql nova user. exmaple:000000</span>
<span class="token assign-left variable">NOVA_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore nova user. exmaple:000000</span>
<span class="token assign-left variable">NOVA_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Neutron Config-------------------##</span>
<span class="token comment">#Password for Mysql neutron user. exmaple:000000</span>
<span class="token assign-left variable">NEUTRON_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore neutron user. exmaple:000000</span>
<span class="token assign-left variable">NEUTRON_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#metadata secret for neutron. exmaple:000000</span>
<span class="token assign-left variable">METADATA_SECRET</span><span class="token operator">=</span>000000

<span class="token comment">#External Network Interface. example:eth1</span>
<span class="token assign-left variable">INTERFACE_NAME</span><span class="token operator">=</span>ens37

<span class="token comment">#External Network The Physical Adapter. example:provider</span>
<span class="token assign-left variable">Physical_NAME</span><span class="token operator">=</span>provider

<span class="token comment">#First Vlan ID in VLAN RANGE for VLAN Network. exmaple:101</span>
<span class="token assign-left variable">minvlan</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">#Last Vlan ID in VLAN RANGE for VLAN Network. example:200</span>
<span class="token assign-left variable">maxvlan</span><span class="token operator">=</span><span class="token number">1000</span>

<span class="token comment">#--------------------Cinder Config--------------------##</span>
<span class="token comment">#Password for Mysql cinder user. exmaple:000000</span>
<span class="token assign-left variable">CINDER_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore cinder user. exmaple:000000</span>
<span class="token assign-left variable">CINDER_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#Cinder Block Disk. example:md126p3</span>
<span class="token assign-left variable">BLOCK_DISK</span><span class="token operator">=</span>sdb1

<span class="token comment">#--------------------Swift Config---------------------##</span>
<span class="token comment">#Password for Keystore swift user. exmaple:000000</span>
<span class="token assign-left variable">SWIFT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#The NODE Object Disk for Swift. example:md126p4.</span>
<span class="token assign-left variable">OBJECT_DISK</span><span class="token operator">=</span>sdb2

<span class="token comment">#The NODE IP for Swift Storage Network. example:x.x.x.x.</span>
<span class="token assign-left variable">STORAGE_LOCAL_NET_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.100.20

<span class="token comment">#--------------------Trove Config----------------------##</span>
<span class="token comment">#Password for Mysql trove user. exmaple:000000</span>
<span class="token assign-left variable">TROVE_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore trove user. exmaple:000000</span>
<span class="token assign-left variable">TROVE_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Heat Config----------------------##</span>
<span class="token comment">#Password for Mysql heat user. exmaple:000000</span>
<span class="token assign-left variable">HEAT_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore heat user. exmaple:000000</span>
<span class="token assign-left variable">HEAT_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Ceilometer Config----------------##</span>
<span class="token comment">#Password for Gnocchi ceilometer user. exmaple:000000</span>
<span class="token assign-left variable">CEILOMETER_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore ceilometer user. exmaple:000000</span>
<span class="token assign-left variable">CEILOMETER_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------AODH Config----------------##</span>
<span class="token comment">#Password for Mysql AODH user. exmaple:000000</span>
<span class="token assign-left variable">AODH_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore AODH user. exmaple:000000</span>
<span class="token assign-left variable">AODH_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------ZUN Config----------------##</span>
<span class="token comment">#Password for Mysql ZUN user. exmaple:000000</span>
<span class="token assign-left variable">ZUN_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore ZUN user. exmaple:000000</span>
<span class="token assign-left variable">ZUN_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore KURYR user. exmaple:000000</span>
<span class="token assign-left variable">KURYR_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------OCTAVIA Config----------------##</span>
<span class="token comment">#Password for Mysql OCTAVIA user. exmaple:000000</span>
<span class="token assign-left variable">OCTAVIA_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore OCTAVIA user. exmaple:000000</span>
<span class="token assign-left variable">OCTAVIA_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Manila Config----------------##</span>
<span class="token comment">#Password for Mysql Manila user. exmaple:000000</span>
<span class="token assign-left variable">MANILA_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore Manila user. exmaple:000000</span>
<span class="token assign-left variable">MANILA_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#The NODE Object Disk for Manila. example:md126p5.</span>
<span class="token assign-left variable">SHARE_DISK</span><span class="token operator">=</span>sdb3

<span class="token comment">#--------------------Cloudkitty Config----------------##</span>
<span class="token comment">#Password for Mysql Cloudkitty user. exmaple:000000</span>
<span class="token assign-left variable">CLOUDKITTY_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore Cloudkitty user. exmaple:000000</span>
<span class="token assign-left variable">CLOUDKITTY_PASS</span><span class="token operator">=</span>000000

<span class="token comment">#--------------------Barbican Config----------------##</span>
<span class="token comment">#Password for Mysql Barbican user. exmaple:000000</span>
<span class="token assign-left variable">BARBICAN_DBPASS</span><span class="token operator">=</span>000000

<span class="token comment">#Password for Keystore Barbican user. exmaple:000000</span>
<span class="token assign-left variable">BARBICAN_PASS</span><span class="token operator">=</span>000000
<span class="token comment">###############################################################</span>
<span class="token comment">#####在vi编辑器中执行:%s/^.\{1\}//  删除每行前1个字符(#号)#####</span>
<span class="token comment">###############################################################</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/openstack/openrc.sh compute:/etc/openstack/</span>

<span class="token comment">#传输完毕后，设置磁盘分区，分出三块！！！对应的磁盘名称写入环境变量中</span>
</code></pre>
<p>1.检查环境变量文件配置正确计 0.5 分</p>
<h3 id="【题目-5】数据库安装与调优-0-5-分"><a href="#【题目-5】数据库安装与调优-0-5-分" class="headerlink" title="【题目 5】数据库安装与调优[0.5 分]"></a>【题目 5】数据库安装与调优[0.5 分]</h3><p>在 controller 节点上使用 iaas-install-mysql.sh 脚本安装 Mariadb、Memcached、RabbitMQ<br>等服务。安装服务完毕后，修改/etc/my.cnf 文件，完成下列要求：</p>
<p>1.设置数据库支持大小写；<br>2.设置数据库缓存 innodb 表的索引，数据，插入数据时的缓冲为 4G；</p>
<p>3.设置数据库的 log buffer 为 64MB；<br>4.设置数据库的 redo log 大小为 256MB；<br>5.设置数据库的 redo log 文件组为 2。<br>完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-pre-host.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-pre-host.sh</span>
<span class="token comment">#执行完这一步，一定要重新连接，刷新一下，不然rabbitmq服务会报错</span>

<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-mysql.sh</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/my.cnf</span>
<span class="token comment">#</span>
<span class="token comment"># This group is read both both by the client and the server</span>
<span class="token comment"># use it for options that affect everything</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span>client-server<span class="token punctuation">]</span>

<span class="token comment">#</span>
<span class="token comment"># This group is read by the server</span>
<span class="token comment">#</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span>
symbolic-links<span class="token operator">=</span><span class="token number">0</span>
default-storage-engine <span class="token operator">=</span> innodb
innodb_file_per_table
collation-server <span class="token operator">=</span> utf8_general_ci
init-connect <span class="token operator">=</span> <span class="token string">'SET NAMES utf8'</span>
character-set-server <span class="token operator">=</span> utf8
<span class="token assign-left variable">max_connections</span><span class="token operator">=</span><span class="token number">10000</span>

innodb_log_buffer_size <span class="token operator">=</span> 4M
<span class="token comment">#此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据。MySQL开发人员建议设置为1－8M之间</span>

innodb_log_file_size <span class="token operator">=</span> 32M
<span class="token comment">#此参数确定数据日志文件的大小，更大的设置可以提高性能，但也会增加恢复故障数据库所需的时间</span>

innodb_log_files_in_group <span class="token operator">=</span> <span class="token number">3</span>
<span class="token comment">#为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3</span>

<span class="token comment">#1，数据库不区分大小写，其中 0：区分大小写，1：不区分大小写</span>
lower_case_table_names <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">#2,设置innodb的数据缓冲为4G</span>
innodb_buffer_pool_size <span class="token operator">=</span> 4G

<span class="token comment">#3，传输数据包的大小值</span>
max_allowed_packet <span class="token operator">=</span> 30M


<span class="token comment">#</span>
<span class="token comment"># include all files from the config directory</span>
<span class="token comment">#</span>
<span class="token operator">!</span>includedir /etc/my.cnf.d

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查数据库配置正确计 0.5 分</p>
<h3 id="【题目-6】Keystone-服务安装与使用-0-5-分"><a href="#【题目-6】Keystone-服务安装与使用-0-5-分" class="headerlink" title="【题目 6】Keystone 服务安装与使用[0.5 分]"></a>【题目 6】Keystone 服务安装与使用[0.5 分]</h3><p>在 controller 节点上使用 iaas-install-keystone.sh 脚本安装 Keystone 服务。安装完成后， 使用相关命令，创建用户 chinaskill，密码为 000000。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-keystone.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source /etc/keystone/admin-openrc.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create --domain huhy --password 000000 chinaskill</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> Field               <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> domain_id           <span class="token operator">|</span> b11e543ea3567ef79cd7a99a34ea156a <span class="token operator">|</span>
<span class="token operator">|</span> enabled             <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                  <span class="token operator">|</span> 8bd1afe33aa34e24aeb9f3d4ea15aa75 <span class="token operator">|</span>
<span class="token operator">|</span> name                <span class="token operator">|</span> chinaskill                       <span class="token operator">|</span>
<span class="token operator">|</span> options             <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> password_expires_at <span class="token operator">|</span> None                             <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#注意我的域名是自定义的，正常应该是demo</span></code></pre>
<p>1.检查keystone 服务安装正确计 0.2 分<br>2.检查chinaskill 用户创建正确计 0.3 分</p>
<h3 id="【题目-7】Glance-安装与使用-0-5-分"><a href="#【题目-7】Glance-安装与使用-0-5-分" class="headerlink" title="【题目 7】Glance 安装与使用[0.5 分]"></a>【题目 7】Glance 安装与使用[0.5 分]</h3><p>在 controller 节点上使用 iaas-install-glance.sh 脚本安装 glance 服务。使用命令将提供的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台， 命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># iaas-install-glance.sh</span>
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># ls</span>
amphora-x64-haproxy.qcow2  CentOS-7-x86_64-2009.qcow2    MySQL_5.6_XD.qcow2
CentOS7_1804.tar           cirros-0.3.4-x86_64-disk.img
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment"># openstack image create --disk-format qcow2 --container-format bare --min-disk 10 --min-ram 1024 --file ./cirros-0.3.4-x86_64-disk.img cirros</span>
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> Field            <span class="token operator">|</span> Value                                                                                                                                                                                      <span class="token operator">|</span>
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ee1eca47dc88f4879d8a229cc70a07c6                                                                                                                                                           <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-09-19T02:51:10Z                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                                                                                                                                                                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">file</span>             <span class="token operator">|</span> /v2/images/47adc4fe-6bd9-4728-809f-c868d433f2d7/file                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 47adc4fe-6bd9-4728-809f-c868d433f2d7                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">10</span>                                                                                                                                                                                         <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">1024</span>                                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> cirros                                                                                                                                                                                     <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 5ef6dd81e4164f8d89e41d5537b148f9
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> properties       <span class="token operator">|</span> <span class="token assign-left variable">os_hash_algo</span><span class="token operator">=</span><span class="token string">'sha512'</span>, <span class="token assign-left variable">os_hash_value</span><span class="token operator">=</span><span class="token string">'1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2'</span>, <span class="token assign-left variable">os_hidden</span><span class="token operator">=</span><span class="token string">'False'</span> <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> schema           <span class="token operator">|</span> /v2/schemas/image
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">13287936</span>
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span>
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-09-19T02:51:11Z
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None
                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> shared
                                                                                        <span class="token operator">|</span>
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token punctuation">[</span>root@controller images<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查glance 服务安装正确计 0.1 分<br>2.检查cirros 镜像最小启动硬盘与内存配置正确计 0.4 分</p>
<h3 id="【题目-8】Nova-安装与优化-0-5-分"><a href="#【题目-8】Nova-安装与优化-0-5-分" class="headerlink" title="【题目 8】Nova 安装与优化[0.5 分]"></a>【题目 8】Nova 安装与优化[0.5 分]</h3><p>在 controller 节点和 compute 节点上分别使用 iaas-install-placement.sh 脚本、iaas-install-nova -controller.sh 脚本、iaas-install-nova-compute.sh 脚本安装Nova 服务。安装完成后，请修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不到 IP 地址而报</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-placement.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-nova-controller.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/nova/nova.conf</span>

<span class="token comment">#vif_plugging_is_fatal=true</span>

改为

<span class="token assign-left variable">vif_plugging_is_fatal</span><span class="token operator">=</span>false
</code></pre>
<p>1.检查nova 服务解决超时问题配置正确计 0.5 分</p>
<h3 id="【题目-9】Neutron-安装-0-5-分"><a href="#【题目-9】Neutron-安装-0-5-分" class="headerlink" title="【题目 9】Neutron 安装[0.5 分]"></a>【题目 9】Neutron 安装[0.5 分]</h3><p>使用提供的脚本 iaas-install-neutron-controller.sh 和 iaas-install-neutron-compute.sh，在controller 和 compute 节点上安装 neutron 服务。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-neutron-controller.sh</span></code></pre>
<p>1.检查neutron 服务安装正确计 0.2 分<br>2.检查neutron 服务的 linuxbridge 网桥服务启动正确计 0.3 分</p>
<h3 id="【题目-10】Dashboard-安装-0-5-分"><a href="#【题目-10】Dashboard-安装-0-5-分" class="headerlink" title="【题目 10】Dashboard 安装[0.5 分]"></a>【题目 10】Dashboard 安装[0.5 分]</h3><p>在controller 节点上使用iaas-install-dashboad.sh 脚本安装dashboad服务。安装完成后， 将 Dashboard 中的 Djingo 数据修改为存储在文件中（此种修改解决了 ALL-in-one 快照在其他云平台 Dashboard 不能访问的问题）。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-dashboard.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/openstack-dashboard/local_settings</span>

SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.cache'</span>

改为

SESSION_ENGINE <span class="token operator">=</span> <span class="token string">'django.contrib.sessions.backends.file'</span></code></pre>
<p>1.检查Dashboard 服务安装正确计 0.2 分<br>2.检查Dashboard 服务中Djingo 数据修改为存储在文件中配置正确计 0.3 分</p>
<h3 id="【题目-11】Swift-安装-0-5-分"><a href="#【题目-11】Swift-安装-0-5-分" class="headerlink" title="【题目 11】Swift 安装[0.5 分]"></a>【题目 11】Swift 安装[0.5 分]</h3><p>在 控 制 节 点 和 计 算 节 点 上 分 别 使 用 iaas-install-swift-controller.sh 和iaas-install-swift-compute.sh 脚本安装 Swift 服务。安装完成后，使用命令创建一个名叫examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并设置分段存放，每一段大小为 10M。完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-swift-controller.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-swift-compute.sh</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda-ks.cfg  cirros-0.3.4-x86_64-disk.img  logininfo.txt
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift post examcontainers</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># swift upload examcontaiers -S 10000000 cirros-0.3.4-x86_64-disk.img</span>
cirros-0.3.4-x86_64-disk.img segment <span class="token number">1</span>
cirros-0.3.4-x86_64-disk.img segment <span class="token number">0</span>
cirros-0.3.4-x86_64-disk.img
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># du -sh cirros-0.3.4-x86_64-disk.img</span>
13M     cirros-0.3.4-x86_64-disk.img
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>

<span class="token comment">#因为镜像就13M，所有存储为两段</span></code></pre>
<p>1.检查 swift 服务安装正确计 0.3 分<br>2.分段上传cirros 镜像正确计 0.2 分</p>
<h3 id="【题目-12】Cinder-创建硬盘-0-5-分"><a href="#【题目-12】Cinder-创建硬盘-0-5-分" class="headerlink" title="【题目 12】Cinder 创建硬盘[0.5 分]"></a>【题目 12】Cinder 创建硬盘[0.5 分]</h3><p>在 控 制 节 点 和 计 算 节 点 分 别 使 用 iaas-install-cinder-controller.sh 、iaas-install-cinder-compute.sh 脚本安装Cinder 服务，请在计算节点，对块存储进行扩容操作， 即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。完成后提交计算节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-cinder-controller.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-cinder-compute.sh</span>

<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME                                            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                                               <span class="token number">8</span>:0    <span class="token number">0</span>  200G  <span class="token number">0</span> disk
├─sda1                                            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2                                            <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  ├─centos-root                                 <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  └─centos-swap                                 <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb                                               <span class="token number">8</span>:16   <span class="token number">0</span>   50G  <span class="token number">0</span> disk
├─sdb1                                            <span class="token number">8</span>:17   <span class="token number">0</span>   10G  <span class="token number">0</span> part
│ ├─cinder--volumes-cinder--volumes--pool_tmeta <span class="token number">253</span>:2    <span class="token number">0</span>   12M  <span class="token number">0</span> lvm
│ │ └─cinder--volumes-cinder--volumes--pool     <span class="token number">253</span>:4    <span class="token number">0</span>  <span class="token number">9</span>.5G  <span class="token number">0</span> lvm
│ └─cinder--volumes-cinder--volumes--pool_tdata <span class="token number">253</span>:3    <span class="token number">0</span>  <span class="token number">9</span>.5G  <span class="token number">0</span> lvm
│   └─cinder--volumes-cinder--volumes--pool     <span class="token number">253</span>:4    <span class="token number">0</span>  <span class="token number">9</span>.5G  <span class="token number">0</span> lvm
├─sdb2                                            <span class="token number">8</span>:18   <span class="token number">0</span>   10G  <span class="token number">0</span> part /swift/node/sdb2
├─sdb3                                            <span class="token number">8</span>:19   <span class="token number">0</span>   10G  <span class="token number">0</span> part
└─sdb4                                            <span class="token number">8</span>:20   <span class="token number">0</span>    5G  <span class="token number">0</span> part
sr0                                              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.4G  <span class="token number">0</span> rom
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay</span>
  --- Volume group ---
  VG Name               cinder-volumes
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">1</span>
  Metadata Sequence No  <span class="token number">4</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">1</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">1</span>
  Act PV                <span class="token number">1</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">10.00</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">2559</span>
  Alloc PE / Size       <span class="token number">2438</span> / <span class="token number">9.52</span> GiB
  Free  PE / Size       <span class="token number">121</span> / <span class="token number">484.00</span> MiB
  VG UUID               3k0yKg-iQB2-b2CM-a0z2-2ddJ-cdG3-8WpyrG

  --- Volume group ---
  VG Name               centos
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">1</span>
  Metadata Sequence No  <span class="token number">3</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">2</span>
  Open LV               <span class="token number">2</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">1</span>
  Act PV                <span class="token number">1</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">4863</span>
  Alloc PE / Size       <span class="token number">4863</span> / <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  Free  PE / Size       <span class="token number">0</span> / <span class="token number">0</span>
  VG UUID               acAXNK-eqKm-qs9b-ly3T-R3Sh-8qyv-nELNWv
  <span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># vgextend cinder-volumes /dev/sdb4</span>
  Volume group <span class="token string">"cinder-volumes"</span> successfully extended
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay</span>
  --- Volume group ---
  VG Name               cinder-volumes
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">2</span>
  Metadata Sequence No  <span class="token number">5</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">1</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">2</span>
  Act PV                <span class="token number">2</span>
  VG Size               <span class="token number">14.99</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">3838</span>
  Alloc PE / Size       <span class="token number">2438</span> / <span class="token number">9.52</span> GiB
  Free  PE / Size       <span class="token number">1400</span> / <span class="token operator">&lt;</span><span class="token number">5.47</span> GiB
  VG UUID               3k0yKg-iQB2-b2CM-a0z2-2ddJ-cdG3-8WpyrG

  --- Volume group ---
  VG Name               centos
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">1</span>
  Metadata Sequence No  <span class="token number">3</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">2</span>
  Open LV               <span class="token number">2</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">1</span>
  Act PV                <span class="token number">1</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">4863</span>
  Alloc PE / Size       <span class="token number">4863</span> / <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  Free  PE / Size       <span class="token number">0</span> / <span class="token number">0</span>
  VG UUID               acAXNK-eqKm-qs9b-ly3T-R3Sh-8qyv-nELNWv

<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查cinder 后端存储扩容成功计 0.5 分</p>
<h3 id="【题目-13】Manila-服务安装与使用-0-5-分"><a href="#【题目-13】Manila-服务安装与使用-0-5-分" class="headerlink" title="【题目 13】Manila 服务安装与使用[0.5 分]"></a>【题目 13】Manila 服务安装与使用[0.5 分]</h3><p>在 控 制 和 计 算 节 点 上 分 别 使 用 iaas-install-manila-controller.sh 和iaas-install-manila-compute.sh 脚本安装 manila 服务。安装服务后创建 default_share_type 共享类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放share01 目录对 OpenStack 管理网段使用权限。最后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-manila-controller.sh</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-manila-compute.sh</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila type-create default_share_type False</span>
+----------------------+--------------------------------------+
<span class="token operator">|</span> Property             <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+----------------------+--------------------------------------+
<span class="token operator">|</span> required_extra_specs <span class="token operator">|</span> driver_handles_share_servers <span class="token builtin class-name">:</span> False <span class="token operator">|</span>
<span class="token operator">|</span> Name                 <span class="token operator">|</span> default_share_type                   <span class="token operator">|</span>
<span class="token operator">|</span> Visibility           <span class="token operator">|</span> public                               <span class="token operator">|</span>
<span class="token operator">|</span> is_default           <span class="token operator">|</span> YES                                  <span class="token operator">|</span>
<span class="token operator">|</span> ID                   <span class="token operator">|</span> 36dddd7a-6c51-4320-9f8e-d99dcb71fcdd <span class="token operator">|</span>
<span class="token operator">|</span> optional_extra_specs <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> Description          <span class="token operator">|</span> None                                 <span class="token operator">|</span>
+----------------------+--------------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila type-list</span>
+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name               <span class="token operator">|</span> visibility <span class="token operator">|</span> is_default <span class="token operator">|</span> required_extra_specs
     <span class="token operator">|</span> optional_extra_specs <span class="token operator">|</span> Description <span class="token operator">|</span>
+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+
<span class="token operator">|</span> 36dddd7a-6c51-4320-9f8e-d99dcb71fcdd <span class="token operator">|</span> default_share_type <span class="token operator">|</span> public     <span class="token operator">|</span> YES        <span class="token operator">|</span> driver_handles_share_servers <span class="token builtin class-name">:</span> False <span class="token operator">|</span>                      <span class="token operator">|</span> None        <span class="token operator">|</span>
+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila create NFS 2 --name share-test</span>
+---------------------------------------+--------------------------------------+
<span class="token operator">|</span> Property                              <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+---------------------------------------+--------------------------------------+
<span class="token operator">|</span> status                                <span class="token operator">|</span> creating                             <span class="token operator">|</span>
<span class="token operator">|</span> share_type_name                       <span class="token operator">|</span> default_share_type                   <span class="token operator">|</span>
<span class="token operator">|</span> description                           <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> availability_zone                     <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> share_network_id                      <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> share_server_id                       <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> share_group_id                        <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">host</span>                                  <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> revert_to_snapshot_support            <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> access_rules_status                   <span class="token operator">|</span> active                               <span class="token operator">|</span>
<span class="token operator">|</span> snapshot_id                           <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> create_share_from_snapshot_support    <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> is_public                             <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> task_state                            <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> snapshot_support                      <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                                    <span class="token operator">|</span> 01b7551c-ac6f-4815-9ade-34dd50d5c489 <span class="token operator">|</span>
<span class="token operator">|</span> size                                  <span class="token operator">|</span> <span class="token number">2</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> source_share_group_snapshot_member_id <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> user_id                               <span class="token operator">|</span> 65355acf2f4e4e8e8e29fd08d7290750     <span class="token operator">|</span>
<span class="token operator">|</span> name                                  <span class="token operator">|</span> share-test                           <span class="token operator">|</span>
<span class="token operator">|</span> share_type                            <span class="token operator">|</span> 36dddd7a-6c51-4320-9f8e-d99dcb71fcdd <span class="token operator">|</span>
<span class="token operator">|</span> has_replicas                          <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> replication_type                      <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> created_at                            <span class="token operator">|</span> <span class="token number">2022</span>-09-19T06:50:18.000000           <span class="token operator">|</span>
<span class="token operator">|</span> share_proto                           <span class="token operator">|</span> NFS                                  <span class="token operator">|</span>
<span class="token operator">|</span> mount_snapshot_support                <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> project_id                            <span class="token operator">|</span> 1b29cb9baa394a0eb3d531913dc9ccec     <span class="token operator">|</span>
<span class="token operator">|</span> metadata                              <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                                   <span class="token operator">|</span>
+---------------------------------------+--------------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila list</span>
+--------------------------------------+------------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name       <span class="token operator">|</span> Size <span class="token operator">|</span> Share Proto <span class="token operator">|</span> Status    <span class="token operator">|</span> Is Public <span class="token operator">|</span> Share Type Name    <span class="token operator">|</span> Host                        <span class="token operator">|</span> Availability Zone <span class="token operator">|</span>
+--------------------------------------+------------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
<span class="token operator">|</span> 01b7551c-ac6f-4815-9ade-34dd50d5c489 <span class="token operator">|</span> share-test <span class="token operator">|</span> <span class="token number">2</span>    <span class="token operator">|</span> NFS         <span class="token operator">|</span> available <span class="token operator">|</span> False     <span class="token operator">|</span> default_share_type <span class="token operator">|</span> compute@lvm<span class="token comment">#lvm-single-pool | nova              |</span>
+--------------------------------------+------------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila access-allow share-test ip 192.168.100.0/24 --access-level rw</span>
+--------------+--------------------------------------+
<span class="token operator">|</span> Property     <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+--------------+--------------------------------------+
<span class="token operator">|</span> access_key   <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> share_id     <span class="token operator">|</span> 01b7551c-ac6f-4815-9ade-34dd50d5c489 <span class="token operator">|</span>
<span class="token operator">|</span> created_at   <span class="token operator">|</span> <span class="token number">2022</span>-09-19T06:51:47.000000           <span class="token operator">|</span>
<span class="token operator">|</span> updated_at   <span class="token operator">|</span> None                                 <span class="token operator">|</span>
<span class="token operator">|</span> access_type  <span class="token operator">|</span> <span class="token function">ip</span>                                   <span class="token operator">|</span>
<span class="token operator">|</span> access_to    <span class="token operator">|</span> <span class="token number">192.168</span>.100.0/24                     <span class="token operator">|</span>
<span class="token operator">|</span> access_level <span class="token operator">|</span> rw                                   <span class="token operator">|</span>
<span class="token operator">|</span> state        <span class="token operator">|</span> queued_to_apply                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> a5fe5b74-e571-405a-a2cb-bda449ed1f53 <span class="token operator">|</span>
<span class="token operator">|</span> metadata     <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                                   <span class="token operator">|</span>
+--------------+--------------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila access-list share-test</span>
+--------------------------------------+-------------+------------------+--------------+--------+------------+----------------------------+------------+
<span class="token operator">|</span> <span class="token function">id</span>                                   <span class="token operator">|</span> access_type <span class="token operator">|</span> access_to        <span class="token operator">|</span> access_level <span class="token operator">|</span> state  <span class="token operator">|</span> access_key <span class="token operator">|</span> created_at                 <span class="token operator">|</span> updated_at <span class="token operator">|</span>
+--------------------------------------+-------------+------------------+--------------+--------+------------+----------------------------+------------+
<span class="token operator">|</span> a5fe5b74-e571-405a-a2cb-bda449ed1f53 <span class="token operator">|</span> <span class="token function">ip</span>          <span class="token operator">|</span> <span class="token number">192.168</span>.100.0/24 <span class="token operator">|</span> rw           <span class="token operator">|</span> active <span class="token operator">|</span> None       <span class="token operator">|</span> <span class="token number">2022</span>-09-19T06:51:47.000000 <span class="token operator">|</span> None       <span class="token operator">|</span>
+--------------------------------------+-------------+------------------+--------------+--------+------------+----------------------------+------------+

<span class="token comment">#查看share-test共享文件目录的访问路径，选做，到此任务已经结束</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># manila show share-test | grep path | cut -d'|' -f3</span>
 path <span class="token operator">=</span> <span class="token number">192.168</span>.100.20:/var/lib/manila/mnt/share-8648e34b-a68b-4710-97fe-4e85515c444e
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mount -t nfs 192.168.100.20:/var/lib/manila/mnt/share-8648e34b-a68b-4710-97fe-4e85515c444e /mnt/</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem               Size  Used Avail Use% Mounted on
devtmpfs                 <span class="token number">1</span>.9G     <span class="token number">0</span>  <span class="token number">1</span>.9G   <span class="token number">0</span>% /dev
tmpfs                    <span class="token number">1</span>.9G  <span class="token number">4</span>.0K  <span class="token number">1</span>.9G   <span class="token number">1</span>% /dev/shm
tmpfs                    <span class="token number">1</span>.9G   12M  <span class="token number">1</span>.9G   <span class="token number">1</span>% /run
tmpfs                    <span class="token number">1</span>.9G     <span class="token number">0</span>  <span class="token number">1</span>.9G   <span class="token number">0</span>% /sys/fs/cgroup
/dev/mapper/centos-root   17G  <span class="token number">4</span>.8G   13G  <span class="token number">29</span>% /
/dev/sda1               1014M  152M  863M  <span class="token number">15</span>% /boot
tmpfs                    378M     <span class="token number">0</span>  378M   <span class="token number">0</span>% /run/user/0
/dev/sdb2                 10G   59M   10G   <span class="token number">1</span>% /swift/node/sdb2
/dev/dm-5                <span class="token number">2</span>.0G  <span class="token number">6</span>.0M  <span class="token number">1</span>.8G   <span class="token number">1</span>% /var/lib/manila/mnt/share-8648e34b-a68b-4710-97fe-4e85515c444e
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre>
<p>1.检查 share01 共享存储正确创建并赋予权限计 0.5 分</p>
<h3 id="【题目-14】Barbican-服务安装与使用-0-5-分"><a href="#【题目-14】Barbican-服务安装与使用-0-5-分" class="headerlink" title="【题目 14】Barbican 服务安装与使用[0.5 分]"></a>【题目 14】Barbican 服务安装与使用[0.5 分]</h3><p>使用 iaas-install-barbican.sh 脚本安装 barbican 服务，安装服务完毕后，使用 openstack 命令创建一个名为 secret01 的密钥，创建完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iaas-install-barbican.sh</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack secret store --name secret01 --payload secretkey</span>
+---------------+-----------------------------------------------------------------------+
<span class="token operator">|</span> Field         <span class="token operator">|</span> Value                                                                 <span class="token operator">|</span>
+---------------+-----------------------------------------------------------------------+
<span class="token operator">|</span> Secret href   <span class="token operator">|</span> http://localhost:9311/v1/secrets/0c75b604-1cae-4172-b632-b769f1d649e3 <span class="token operator">|</span>
<span class="token operator">|</span> Name          <span class="token operator">|</span> secret01                                                              <span class="token operator">|</span>
<span class="token operator">|</span> Created       <span class="token operator">|</span> None                                                                  <span class="token operator">|</span>
<span class="token operator">|</span> Status        <span class="token operator">|</span> None                                                                  <span class="token operator">|</span>
<span class="token operator">|</span> Content types <span class="token operator">|</span> None                                                                  <span class="token operator">|</span>
<span class="token operator">|</span> Algorithm     <span class="token operator">|</span> aes                                                                   <span class="token operator">|</span>
<span class="token operator">|</span> Bit length    <span class="token operator">|</span> <span class="token number">256</span>                                                                   <span class="token operator">|</span>
<span class="token operator">|</span> Secret <span class="token builtin class-name">type</span>   <span class="token operator">|</span> opaque                                                                <span class="token operator">|</span>
<span class="token operator">|</span> Mode          <span class="token operator">|</span> cbc                                                                   <span class="token operator">|</span>
<span class="token operator">|</span> Expiration    <span class="token operator">|</span> None                                                                  <span class="token operator">|</span>
+---------------+-----------------------------------------------------------------------+</code></pre>
<p>1.检查 secret01 密钥创建正确计 0.5 分</p>
<h3 id="【题目-15】Cloudkitty-服务安装与使用-1-分"><a href="#【题目-15】Cloudkitty-服务安装与使用-1-分" class="headerlink" title="【题目 15】Cloudkitty 服务安装与使用[1 分]"></a>【题目 15】Cloudkitty 服务安装与使用[1 分]</h3><p>使用 iaas-install-cloudkitty.sh 脚本安装cloudkitty 服务，安装完毕后，启用 hashmap 评级模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置若超过 50GB 的阈值，应用 2%的折扣（0.98）。设置完成后提交控制节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#0.启用hashmap</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack rating module enable hashmap </span>

<span class="token comment">#1.创建hashmap service</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack rating  hashmap service create volume.size </span>
+--------+--------------------------------------+
<span class="token operator">|</span> Name   <span class="token operator">|</span> Service ID                           <span class="token operator">|</span>
+--------+--------------------------------------+
<span class="token operator">|</span> volume.size <span class="token operator">|</span> 09da4a8b-b849-4715-a8e3-7cd12dfcf46e <span class="token operator">|</span>
+--------+--------------------------------------+

<span class="token comment">#2.创建hashmap service group</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack rating hashmap group create  volume_thresholds </span>
openstack rating hashmap group create  volume_thresholds 
+-------------------+--------------------------------------+
<span class="token operator">|</span> Name              <span class="token operator">|</span> Group ID                             <span class="token operator">|</span>
+-------------------+--------------------------------------+
<span class="token operator">|</span> volume_thresholds <span class="token operator">|</span> 8b3dfe73-5efb-46ab-a93b-dc9519063ed6 <span class="token operator">|</span>
+-------------------+--------------------------------------+

<span class="token comment">#3.创建volume单价</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack rating hashmap mapping create   -s  09da4a8b-b849-4715-a8e3-7cd12dfcf46e -g 8b3dfe73-5efb-46ab-a93b-dc9519063ed6  -t flat  0.01  </span>

<span class="token comment">#4.创建service rule</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack rating hashmap threshold create   -s  09da4a8b-b849-4715-a8e3-7cd12dfcf46e -g 8b3dfe73-5efb-46ab-a93b-dc9519063ed6  -t rate 50 0.98</span>
</code></pre>
<p>1.检查hashmap 评级模块启用成功计 0.2 分<br>2.检查服务匹配规则volume.size 创建成功 0.8 分</p>
<h3 id="【题目-16】OpenStack-平台内存优化-0-5-分"><a href="#【题目-16】OpenStack-平台内存优化-0-5-分" class="headerlink" title="【题目 16】OpenStack 平台内存优化[0.5 分]"></a>【题目 16】OpenStack 平台内存优化[0.5 分]</h3><p>搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。完成后提交控制节点<br>的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># find / -name defrag</span>
/sys/kernel/mm/transparent_hugepage/defrag
/sys/kernel/mm/transparent_hugepage/khugepaged/defrag
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># echo never &gt; /sys/kernel/mm/transparent_hugepage/defr</span>
ag 
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/defrag </span>
always madvise <span class="token punctuation">[</span>never<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre>
<p>1.检查系统内存优化成功计 0.5 分</p>
<h3 id="【题目-17】修改文件句柄数-0-5-分"><a href="#【题目-17】修改文件句柄数-0-5-分" class="headerlink" title="【题目 17】修改文件句柄数[0.5 分]"></a>【题目 17】修改文件句柄数[0.5 分]</h3><p>Linux 服务器大并发时，往往需要预先调优 Linux 参数。默认情况下，Linux 最大文件句柄数为 1024 个。当你的服务器在大并发达到极限时，就会报出“too many open files”。创建一台云主机，修改相关配置，将控制节点的最大文件句柄数永久修改为 65535。配置完成后提交 controller 点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ulimit -n</span>
<span class="token number">1024</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  echo "* soft nofile 65535" &gt;&gt; /etc/security/limits.conf</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  echo "* hard nofile 65535" &gt;&gt; /etc/security/limits.conf</span>

*       <span class="token comment">#代表所有用户</span>
soft    <span class="token comment">#超过文件句柄数时，仅提示</span>
hard    <span class="token comment">#超过文件句柄数时，直接限制</span>
Last login: Thu May  <span class="token number">5</span> <span class="token number">19</span>:26:47 <span class="token number">2022</span> from <span class="token number">10.60</span>.2.201


 <span class="token comment">#########################</span>
 <span class="token comment">#  Welcome to XianDian  #</span>
 <span class="token comment">#########################</span>


<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ulimit -n</span>
<span class="token number">65535</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre>
<p>1.检查配置 linux 系统句柄数为 65535 成功计 0.5 分</p>
<h3 id="【题目-18】Linux-系统调优-防止SYN-攻击-1-分"><a href="#【题目-18】Linux-系统调优-防止SYN-攻击-1-分" class="headerlink" title="【题目 18】Linux 系统调优-防止SYN 攻击[1 分]"></a>【题目 18】Linux 系统调优-防止SYN 攻击[1 分]</h3><p>修改 controller 节点的相关配置文件，开启 SYN cookie，防止 SYN 洪水攻击。完成后提交 controller 节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysctl.conf</span>

<span class="token comment">#添加以下参数</span>
<span class="token assign-left variable">net.ipv4.tcp_max_syn_backlog</span><span class="token operator">=</span><span class="token number">2048</span>

<span class="token assign-left variable">net.ipv4.tcp_syncookies</span><span class="token operator">=</span><span class="token number">1</span>

net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">0</span>

<span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">2048</span>
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
sysctl: setting key <span class="token string">"net.ipv4.tcp_syn_retries"</span><span class="token builtin class-name">:</span> Invalid argument
net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查开启SYN cookie 配置计 1 分</p>
<h2 id="【任务-2】私有云服务运维-15-分"><a href="#【任务-2】私有云服务运维-15-分" class="headerlink" title="【任务 2】私有云服务运维[15 分]"></a>【任务 2】私有云服务运维[15 分]</h2><h3 id="【题目-1】OpenStack-开放镜像权限-0-5-分"><a href="#【题目-1】OpenStack-开放镜像权限-0-5-分" class="headerlink" title="【题目 1】OpenStack 开放镜像权限[0.5 分]"></a>【题目 1】OpenStack 开放镜像权限[0.5 分]</h3><p>使用 OpenStack 私 有 云 平 台 ， 在 OpenStack 平台的 admin 项 目 中 使 用cirros-0.3.4-x86_64-disk.img 镜像文件创建名为glance-cirros 的镜像，通过OpenStack 命令将glance-cirros 镜像指定 demo 项目进行共享使用。配置完成后提交controller 点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image create --disk-format qcow2 --container-format bare --file cirros-0.3.4-x86_64-disk.img glance-cirros</span>
<span class="token number">9</span>+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> Field            <span class="token operator">|</span> Value                                                                                                                                                                                      <span class="token operator">|</span>
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> checksum         <span class="token operator">|</span> ee1eca47dc88f4879d8a229cc70a07c6                                                                                                                                                           <span class="token operator">|</span>
<span class="token operator">|</span> container_format <span class="token operator">|</span> bare                                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> created_at       <span class="token operator">|</span> <span class="token number">2022</span>-09-19T07:02:51Z                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> disk_format      <span class="token operator">|</span> qcow2                                                                                                                                                                                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">file</span>             <span class="token operator">|</span> /v2/images/3bac7fd7-bc66-4586-9872-3cbea90da5d2/file                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>               <span class="token operator">|</span> 3bac7fd7-bc66-4586-9872-3cbea90da5d2                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">|</span> min_disk         <span class="token operator">|</span> <span class="token number">0</span>

    <span class="token operator">|</span>
<span class="token operator">|</span> min_ram          <span class="token operator">|</span> <span class="token number">0</span>

    <span class="token operator">|</span>
<span class="token operator">|</span> name             <span class="token operator">|</span> glance-cirros

    <span class="token operator">|</span>
<span class="token operator">|</span> owner            <span class="token operator">|</span> 1b29cb9baa394a0eb3d531913dc9ccec

    <span class="token operator">|</span>
<span class="token operator">|</span> properties       <span class="token operator">|</span> <span class="token assign-left variable">os_hash_algo</span><span class="token operator">=</span><span class="token string">'sha512'</span>, <span class="token assign-left variable">os_hash_value</span><span class="token operator">=</span><span class="token string">'1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2'</span>, <span class="token assign-left variable">os_hidden</span><span class="token operator">=</span><span class="token string">'False'</span> <span class="token operator">|</span>
<span class="token operator">|</span> protected        <span class="token operator">|</span> False

    <span class="token operator">|</span>
<span class="token operator">|</span> schema           <span class="token operator">|</span> /v2/schemas/image

    <span class="token operator">|</span>
<span class="token operator">|</span> size             <span class="token operator">|</span> <span class="token number">13287936</span>

    <span class="token operator">|</span>
<span class="token operator">|</span> status           <span class="token operator">|</span> active

    <span class="token operator">|</span>
<span class="token operator">|</span> tags             <span class="token operator">|</span>

    <span class="token operator">|</span>
<span class="token operator">|</span> updated_at       <span class="token operator">|</span> <span class="token number">2022</span>-09-19T07:02:53Z

    <span class="token operator">|</span>
<span class="token operator">|</span> virtual_size     <span class="token operator">|</span> None

    <span class="token operator">|</span>
<span class="token operator">|</span> visibility       <span class="token operator">|</span> shared

    <span class="token operator">|</span>
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack domain list</span>
+----------------------------------+---------+---------+--------------------+
<span class="token operator">|</span> ID                               <span class="token operator">|</span> Name    <span class="token operator">|</span> Enabled <span class="token operator">|</span> Description        <span class="token operator">|</span>
+----------------------------------+---------+---------+--------------------+
<span class="token operator">|</span> 7fc907bd4a6e471aa6d714ff66646d2a <span class="token operator">|</span> huhy    <span class="token operator">|</span> True    <span class="token operator">|</span> Default Domain     <span class="token operator">|</span>
<span class="token operator">|</span> default                          <span class="token operator">|</span> Default <span class="token operator">|</span> True    <span class="token operator">|</span> The default domain <span class="token operator">|</span>
+----------------------------------+---------+---------+--------------------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># glance member-create 3bac7fd7-bc66-4586-9872-3cbea90da5d2 7fc907bd4a6e471aa6d714ff66646d2a</span>
<span class="token comment"># 镜像id 域名id</span>
+--------------------------------------+----------------------------------+---------+
<span class="token operator">|</span> Image ID                             <span class="token operator">|</span> Member ID                        <span class="token operator">|</span> Status  <span class="token operator">|</span>
+--------------------------------------+----------------------------------+---------+
<span class="token operator">|</span> 3bac7fd7-bc66-4586-9872-3cbea90da5d2 <span class="token operator">|</span> 7fc907bd4a6e471aa6d714ff66646d2a <span class="token operator">|</span> pending <span class="token operator">|</span>
+--------------------------------------+----------------------------------+---------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># glance member-update 3bac7fd7-bc66-4586-9872-3cbea90da5d2 7fc907bd4a6e471aa6d714ff66646d2a accepted                                                                                    +--------------------------------------+----------------------------------+----------+</span>
<span class="token operator">|</span> Image ID                             <span class="token operator">|</span> Member ID                        <span class="token operator">|</span> Status   <span class="token operator">|</span>
+--------------------------------------+----------------------------------+----------+
<span class="token operator">|</span> 3bac7fd7-bc66-4586-9872-3cbea90da5d2 <span class="token operator">|</span> 7fc907bd4a6e471aa6d714ff66646d2a <span class="token operator">|</span> accepted <span class="token operator">|</span>
+--------------------------------------+----------------------------------+----------+
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre>
<p>1.检查glance-cirros 镜像权限开放正确计 0.5 分</p>
<h3 id="【题目-2】OpenStack-消息队列调优-0-5-分"><a href="#【题目-2】OpenStack-消息队列调优-0-5-分" class="headerlink" title="【题目 2】OpenStack 消息队列调优[0.5 分]"></a>【题目 2】OpenStack 消息队列调优[0.5 分]</h3><p>OpenStack 各服务内部通信都是通过 RPC 来交互，各 agent 都需要去连接 RabbitMQ； 随着各服务 agent 增多，MQ 的连接数会随之增多，最终可能会到达上限，成为瓶颈。使用自行搭建的OpenStack 私有云平台，分别通过用户级别、系统级别、配置文件来设置RabbitMQ 服务的最大连接数为 10240，配置完成后提交修改节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/sysctl.conf</span>
fs.file-max<span class="token operator">=</span><span class="token number">10240</span>
<span class="token comment">#在sysctl.conf文件的最下方添加一行fs.file-max=10240</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
fs.file-max <span class="token operator">=</span> <span class="token number">10240</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/security/limits.conf</span>
openstack soft     nofile  <span class="token number">10240</span>
openstack hard     nofile  <span class="token number">10240</span>
<span class="token comment">#在配置文件的最后添加两行内容如上,修改完之后，保存退出</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/lib/systemd/system/rabbitmq-server.service</span>
<span class="token comment">#在[Service]下添加一行参数如下：</span>
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">10240</span>
<span class="token comment">#重启服务</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart rabbitmq-server</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># rabbitmqctl status</span>
Status of <span class="token function">node</span> rabbit@controller
<span class="token punctuation">[</span><span class="token punctuation">{</span>pid,4561<span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>running_applications,
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token punctuation">{</span>file_descriptors,
     <span class="token punctuation">[</span><span class="token punctuation">{</span>total_limit,10140<span class="token punctuation">}</span>,   <span class="token comment">#已经有100个连接数,可以看到当前的RabbitMQ已被修改</span>
      <span class="token punctuation">{</span>total_used,77<span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>sockets_limit,9124<span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>sockets_used,75<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>processes,<span class="token punctuation">[</span><span class="token punctuation">{</span>limit,1048576<span class="token punctuation">}</span>,<span class="token punctuation">{</span>used,1150<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>run_queue,0<span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>uptime,40<span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>kernel,<span class="token punctuation">{</span>net_ticktime,60<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<p>1.检查 rabbitmq 服务最大连接数正确计 0.5 分</p>
<h3 id="【题目-3】OpenStack-Glance-镜像压缩-0-5-分"><a href="#【题目-3】OpenStack-Glance-镜像压缩-0-5-分" class="headerlink" title="【题目 3】OpenStack Glance 镜像压缩[0.5 分]"></a>【题目 3】OpenStack Glance 镜像压缩[0.5 分]</h3><p>使用自行搭建的 OpenStack 平台。在 HTTP 服务中存在一个镜像为CentOS7.5-compress.qcow2 的镜像，请使用 qemu 相关命令，对该镜像进行压缩，压缩后的镜像命名为chinaskill-js-compress.qcow2 并存放在/root 目录下。完成后提交 controller 点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># du -sh CentOS7.5-compress.qcow2</span>
892M CentOS7.5-compress.qcow2
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># qemu-img convert -c -O qcow2 CentOS7.5-compress.qcow2 CentOS7.5-compress2.qcow2</span>

<span class="token parameter variable">-c</span> 压缩
<span class="token parameter variable">-O</span> qcow2 输出格式为 qcow2
CentOS7.5-compress.qcow2   被压缩的文件
CentOS7.5-compress2.qcow2 压缩完成后文件

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># du -sh CentOS7.5-compress2.qcow2</span>
405M CentOS7.5-compress2.qcow2
</code></pre>
<p>1.检查镜像压缩正确计 0.5 分</p>
<h3 id="【题目-4】glance-对接-cinder-后端存储-0-5-分"><a href="#【题目-4】glance-对接-cinder-后端存储-0-5-分" class="headerlink" title="【题目 4】glance 对接 cinder 后端存储[0.5 分]"></a>【题目 4】glance 对接 cinder 后端存储[0.5 分]</h3><p>在自行搭建的OpenStack 平台中修改相关参数，使glance 可以使用cinder 作为后端存储， 将镜像存储于cinder 卷中。使用 cirros-0.3.4-x86_64-disk.img 文件创建 cirros-image 镜像存储于 cirros-cinder 卷中，通过 cirros-image 镜像使用 cinder 卷启动盘的方式进行创建虚拟机。完成后提交修改节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/glance/glance-api.conf</span>

<span class="token comment">#show_multiple_locations = false</span>

改为
show_multiple_locations <span class="token operator">=</span> <span class="token boolean">true</span>


<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart openstack-glance-*</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/cinder/cinder.conf</span>

<span class="token comment">#allowed_direct_url_schemes =</span>
改为
allowed_direct_url_schemes <span class="token operator">=</span>cinder

<span class="token comment">#image_upload_use_internal_tenant = false</span>
改为
image_upload_use_internal_tenant <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">#最后重启cinder</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart openstack-cinderack-cinder-scheduler.service httpd</span>

代码不全,还差一些操作,只有一半的分
</code></pre>

<p>1.检查修改glance 后端存储为 cinder 正确计 0.5 分</p>
<h3 id="【题目-5】OpenStack-Heat-运维：创建容器-0-5-分"><a href="#【题目-5】OpenStack-Heat-运维：创建容器-0-5-分" class="headerlink" title="【题目 5】OpenStack Heat 运维：创建容器[0.5 分]"></a>【题目 5】OpenStack Heat 运维：创建容器[0.5 分]</h3><p>在自行搭建的 OpenStack 私 有 云 平 台 上 ， 在 /root 目录下编写 Heat 模板create_container.yaml，要求执行 yaml 文件可以创建名为 heat-swift 的容器。完成后提交控制节点的用户名、密码和 IP 地址到答题框。（在提交信息前请准备好 yaml 模板执行的环境）</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vim create_container.yaml</span>

heat_template_version: <span class="token number">2014</span>-10-16
resources:
  user:
    type: OS::Container::Swift
    properties:
      name: heat-swift

<span class="token comment">#此类题目，在dashboard界面上都有模板可以查询</span></code></pre>
<p>1.执行heat 模板文件成功创建容器计 0.5 分</p>
<h3 id="【题目-6】OpenStack-Nova-清除缓存-0-5-分"><a href="#【题目-6】OpenStack-Nova-清除缓存-0-5-分" class="headerlink" title="【题目 6】OpenStack Nova 清除缓存[0.5 分]"></a>【题目 6】OpenStack Nova 清除缓存[0.5 分]</h3><p>在 OpenStack 平台的一台计算节点创建虚拟机，若是第一次在该节点创建次虚拟机，会先将镜像文件复制到该计算节点目录/var/lib/nova/instances/_base。长期下来，该目录会占用比较大的磁盘空间而要清理。可以通过修改 nova 的配置文件来自动清理该缓存目录，即在该节点没有使用某镜像启动的云主机，那么这个镜像在过一定的时间后会被自动删除。配置完成后提交改动节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">此题默认配置文件是是正确的，直接提交即可得分</code></pre>
<p>1.检查nova 配置自动清理缓存文件正确计 0.5 分</p>
<h3 id="【题目-7】Redis-一主二从三哨兵模式-1-分"><a href="#【题目-7】Redis-一主二从三哨兵模式-1-分" class="headerlink" title="【题目 7】Redis 一主二从三哨兵模式[1 分]"></a>【题目 7】Redis 一主二从三哨兵模式[1 分]</h3><p>使用提供的 OpenStack 私有云平台，申请三台 CentOS7.9 系统的云主机，使用提供的http 源，在三个节点自行安装 Redis 服务并启动，配置 Redis 的访问需要密码，密码设置为123456。然后将这三个 Redis 节点配置为 Redis 的一主二从三哨兵架构，即一个 Redis 主节点，两个从节点，三个节点均为哨兵节点。配置完成后提交Redis 主节点的用户名、密码和IP 地址到答题框。</p>
<p>（1）环境配置</p>
<table>
<thead>
<tr>
<th align="center">主机</th>
<th align="center">系统</th>
<th align="center">IP</th>
<th align="center">安装包</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Master</td>
<td align="center">CentOS7.9</td>
<td align="center">192.168.154.19</td>
<td align="center">redis-5.0.7.tar.gz</td>
</tr>
<tr>
<td align="center">Slave1</td>
<td align="center">CentOS7.9</td>
<td align="center">192.168.154.20</td>
<td align="center">redis-5.0.7.tar.gz</td>
</tr>
<tr>
<td align="center">Slave2</td>
<td align="center">CentOS7.9</td>
<td align="center">192.168.154.21</td>
<td align="center">redis-5.0.7.tar.gz</td>
</tr>
</tbody></table>
<p>(2) 修改 Redis 配置文件（所有节点操作)</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">systemctl stop firewalld
setenforce <span class="token number">0</span>
 
<span class="token function">vim</span> /opt/redis-5.0.7/sentinel.conf
protected-mode no								<span class="token comment">#17行，关闭保护模式</span>
port <span class="token number">26379</span>										<span class="token comment">#21行，Redis哨兵默认的监听端口</span>
daemonize <span class="token function">yes</span>									<span class="token comment">#26行，指定sentinel为后台启动</span>
logfile <span class="token string">"/var/log/sentinel.log"</span>					<span class="token comment">#36行，指定日志存放路径</span>
<span class="token function">dir</span> <span class="token string">"/var/lib/redis/6379"</span>						<span class="token comment">#65行，指定数据库存放路径</span>
sentinel monitor mymaster <span class="token number">192.168</span>.154.19 <span class="token number">6379</span> <span class="token number">2</span>	<span class="token comment">#84行，修改 指定该哨兵节点监控192.168.184.10:6379这个主节点，该主节点的名称是mymaster，最后的2的含义与主节点的故障判定有关：至少需要2个哨兵节点同意，才能判定主节点故障并进行故障转移</span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span>	<span class="token comment">#113行，判定服务器down掉的时间周期，默认30000毫秒（30秒）</span>
sentinel failover-timeout mymaster <span class="token number">180000</span>		<span class="token comment">#146行，故障节点的最大超时时间为180000（180秒）</span></code></pre>
<p><img src="https://telegraph-image-7df.pages.dev/file/dd1e6b8f434f6f5af4d88.png"><br><img src="https://telegraph-image-7df.pages.dev/file/cad32d1b5b0e18e13f31f.png"><br><img src="https://telegraph-image-7df.pages.dev/file/f7e79846ca8912bb57d84.png"><br><img src="https://telegraph-image-7df.pages.dev/file/490ebb00f4348323ffde4.png"><br> （3)启动哨兵模式</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /opt/redis-5.0.7/
redis-sentinel sentinel.conf <span class="token operator">&amp;</span>
注意！先启动主服务器，再启动从服务器</code></pre>

<p><img src="https://telegraph-image-7df.pages.dev/file/94851e1094c6bb6966817.png"><br><img src="https://telegraph-image-7df.pages.dev/file/26e4cf2bc7217b745c979.png"><br><img src="https://telegraph-image-7df.pages.dev/file/434c1cb4561e55b899474.png"></p>
<p>（4）查看哨兵信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@slave2 redis-5.0.7<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 26379 info Sentinel</span>
<span class="token comment"># Sentinel</span>
sentinel_masters:1
sentinel_tilt:0
sentinel_running_scripts:0
sentinel_scripts_queue_length:0
sentinel_simulate_failure_flags:0
master0:name<span class="token operator">=</span>mymaster,status<span class="token operator">=</span>ok,address<span class="token operator">=</span><span class="token number">192.168</span>.58.30:6379,slaves<span class="token operator">=</span><span class="token number">2</span>,sentinels<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+  完成                  redis-sentinel sentinel.conf</code></pre>

<p>1.检查 redis 主从集群部署正确计 0.5 分<br>2.检查 redis 集群部署为哨兵节点正确计 0.5 分</p>
<h3 id="【题目-8】Redis-服务调优-AOF-1-分"><a href="#【题目-8】Redis-服务调优-AOF-1-分" class="headerlink" title="【题目 8】Redis 服务调优-AOF[1 分]"></a>【题目 8】Redis 服务调优-AOF[1 分]</h3><p>使用上一题安装的Redis 服务。在 Redis 中，AOF 配置为以三种不同的方式在磁盘上执行 write 或者 fsync。假设当前 Redis 压力过大，请配置 Redis 不执行 fsync。除此之外，避免AOF 文件过大，Redis 会进行 AOF 重写，生成缩小的 AOF 文件。请修改配置，让 AOF 重写时，不进行fsync 操作。配置完成后提交 Redis 节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/redis.conf</span>

no-appendfsync-on-rewrite no
aof-rewrite-incremental-fsync <span class="token function">yes</span>

<span class="token comment">#连个参数分别改为</span>

aof-rewrite-incremental-fsync no
no-appendfsync-on-rewrite <span class="token function">yes</span>
<span class="token comment">#配置就是设置为yes时候，在aof重写期间会停止aof的fsync操作</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart redis</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查配置 redis 不执行 fsync 正确计 0.5 分、<br>2.检查配置 redis 进行 AOF 重写不执行 fsync 正确计 0.5 分</p>
<h3 id="【题目-9】应用部署：堡垒机部署-0-5-分"><a href="#【题目-9】应用部署：堡垒机部署-0-5-分" class="headerlink" title="【题目 9】应用部署：堡垒机部署[0.5 分]"></a>【题目 9】应用部署：堡垒机部署[0.5 分]</h3><p>使用提供的 OpenStack 平台申请一台 CentOS7.9 的云主机，使用提供的软件包安装JumpServer 堡垒机服务，并配置使用该堡垒机对接自己安装的 controller 和 compute 节点。完成后提交 JumpServer 节点的用户名、密码和 IP 地址到答题框。</p>
<p>使用提供的软件包配置Yum源，通过地址将jumpserver.tar.gz软件包下载至Jumpserver节点的/root目录下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda-ks.cfg  jumpserver.tar.gz  original-ks.cfg</code></pre>
<p>解压软件包jumpserver.tar.gz至/opt目录下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># tar -zxvf jumpserver.tar.gz -C /opt/</span>
<span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># ls /opt/</span>
compose  config  <span class="token function">docker</span>  docker.service  images  jumpserver-repo  static.env</code></pre>
<p>将默认Yum源移至其他目录，创建本地Yum源文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># mv /etc/yum.repos.d/* /mnt/</span>
<span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># cat &gt;&gt; /etc/yum.repos.d/jumpserver.repo &lt;&lt; EOF</span>
<span class="token punctuation">[</span>jumpserver<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>jumpserver
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/jumpserver-repo
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
EOF
<span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
repo <span class="token function">id</span>		repo name		status
jumpserver	jumpserver		<span class="token number">2</span></code></pre>

<p>安装Python数据库</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver ~<span class="token punctuation">]</span><span class="token comment"># yum install python2 -y</span></code></pre>
<p>安装配置Docker环境</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># cp -rf /opt/docker/* /usr/bin/</span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># chmod 775 /usr/bin/docker*</span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># cp -rf /opt/docker.service /etc/systemd/system</span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># chmod 775 /etc/systemd/system/docker.service </span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># systemctl enable docker --now</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /etc/systemd/system/dock
er.service.</code></pre>
<p>验证服务状态</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># docker -v</span>
Docker version <span class="token number">18.06</span>.3-ce, build d7080c1
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># docker-compose -v</span>
<span class="token function">docker-compose</span> version <span class="token number">1.27</span>.4, build <span class="token number">40524192</span>
<span class="token punctuation">[</span>root@jumpserver opt<span class="token punctuation">]</span><span class="token comment"># </span></code></pre>
<p>安装Jumpserver服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver images<span class="token punctuation">]</span><span class="token comment"># ls</span>
jumpserver_core_v2.11.4.tar  jumpserver_lion_v2.11.4.tar  jumpserver_nginx_alpine2.tar
jumpserver_koko_v2.11.4.tar  jumpserver_luna_v2.11.4.tar  jumpserver_redis_6-alpine.tar
jumpserver_lina_v2.11.4.tar  jumpserver_mysql_5.tar       load.sh
<span class="token punctuation">[</span>root@jumpserver images<span class="token punctuation">]</span><span class="token comment"># cat load.sh </span>
<span class="token comment">#!/bin/bash</span>
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_core_v2.11.4.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_koko_v2.11.4.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_lina_v2.11.4.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_lion_v2.11.4.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_luna_v2.11.4.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_mysql_5.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_nginx_alpine2.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> jumpserver_redis_6-alpine.tar
<span class="token punctuation">[</span>root@jumpserver images<span class="token punctuation">]</span><span class="token comment"># sh load.sh </span></code></pre>
<p>创建Jumpserver服务组件目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver images<span class="token punctuation">]</span><span class="token comment"># mkdir -p /opt/jumpserver/{core,koko,lion,mysql,nginx,redis}</span>
<span class="token punctuation">[</span>root@jumpserver images<span class="token punctuation">]</span><span class="token comment"># cp -rf /opt/config /opt/jumpserver/</span></code></pre>
<p>生效环境变量static.env，使用所提供的脚本up.sh启动Jumpserver服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@jumpserver compose<span class="token punctuation">]</span><span class="token comment"># ls</span>
config_static                docker-compose-lb.yml              docker-compose-network.yml         down.sh
docker-compose-app.yml       docker-compose-mysql-internal.yml  docker-compose-redis-internal.yml  up.sh
docker-compose-es.yml        docker-compose-mysql.yml           docker-compose-redis.yml
docker-compose-external.yml  docker-compose-network_ipv6.yml    docker-compose-task.yml
<span class="token punctuation">[</span>root@jumpserver compose<span class="token punctuation">]</span><span class="token comment"># source /opt/static.env </span>
<span class="token punctuation">[</span>root@jumpserver compose<span class="token punctuation">]</span><span class="token comment"># sh up.sh </span>
Creating network <span class="token string">"jms_net"</span> with driver <span class="token string">"bridge"</span>
Creating jms_redis <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_mysql <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_core  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_lina   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_nginx  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_celery <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_lion   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_luna   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating jms_koko   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@jumpserver compose<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>浏览器访问<a target="_blank" rel="noopener" href="http://10.24.193.142/">http://10.24.193.142</a> Jumpserver Web登录（admin/admin）<br><img src="https://telegraph-image-7df.pages.dev/file/cedfd6e5e6af3a67d424c.png" alt="图1 登录.png"></p>
<p>登录成功后，会提示设置新密码，如图2所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/c15f3f0181c24584851a3.png" alt="图2 修改密码.png"></p>
<p>登录平台后，单击页面右上角下拉菜单切换中文字符设置，如图3所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/da386e0374242b4590a60.png" alt="图3 首页.png"></p>
<p>至此Jumpserver安装完成。</p>
<p>（6）管理资产</p>
<p>使用管理员admin用户登录Jumpserver管理平台，单击左侧导航栏，展开“资产管理”项目，选择“管理用户”，单击右侧“创建”按钮，如图4所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/1b806211365d32c6e1868.png" alt="图4 管理用户.png"></p>
<p>创建远程连接用户，用户名为root密码为“Abc@1234”，单击“提交”按钮进行创建，如图5所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/59a099ea81d11e7f4bd3c.png" alt="图5 创建管理用户.png"></p>
<p>选择“系统用户”，单击右侧“创建”按钮，创建系统用户，选择主机协议“SSH”，设置用户名root，密码为服务器SSH密码并单击“提交”按钮，如图6所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/b04e215e21d21725d99f8.png" alt="图6 创建系统用户.png"></p>
<p>单击左侧导航栏，展开“资产管理”项目，选择“资产列表”，单击右侧“创建”按钮，如图7所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/ea9b58265736443fd1e8c.png" alt="图7 管理资产.png"></p>
<p>创建资产，将云平台主机（controller）加入资产内，如图8、图9所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/7e313f485a0739e42d960.png" alt="图8 创建资产controller.png"></p>
<p><img src="https://telegraph-image-7df.pages.dev/file/9b72454925357ff1defe6.png" alt="图9 创建成功.png"></p>
<p>（7）资产授权</p>
<p>单击左侧导航栏，展开“权限管理”项目，选择“资产授权”，单击右侧“创建”按钮，创建资产授权规则，如图10所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/d4722884ab8e7f5135b40.png" alt="图10 创建资产授权规则.png"></p>
<p>（8）测试连接</p>
<p>单击右上角管理员用户下拉菜单，选择“用户界面”，如图11所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/3af82f5b92323c2dfe9cd.png" alt="图11 创建资产授权规则.png"></p>
<p>如果未出现Default项目下的资产主机，单击收藏夹后“刷新”按钮进行刷新，如图12所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/1420f211fd9ebc4006fb5.png" alt="图12 查看资产.png"></p>
<p>单击左侧导航栏，选择“Web终端”进入远程连接页面，如图13所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/abc429a6d3eb20259ff4d.png" alt="图13 进入远程连接终端.png"></p>
<p>单击左侧Default，展开文件夹，单击controller主机，右侧成功连接主机，如图14所示：</p>
<p><img src="https://telegraph-image-7df.pages.dev/file/2d57902e34c54062b1bd5.png" alt="图14 测试连接.png"></p>
<p>至此OpenStack对接堡垒机案例操作成功。</p>
<h3 id="【题目-10】skywalking-服务部署与应用-1-分"><a href="#【题目-10】skywalking-服务部署与应用-1-分" class="headerlink" title="【题目 10】skywalking 服务部署与应用[1 分]"></a>【题目 10】skywalking 服务部署与应用[1 分]</h3><p>使用提供的 OpenStack 私有云平台，申请一台 centos7.9 系统的云主机，使用提供的软件包安装 Elasticsearch 服务和 skywalking 服务，将 skywalking 的 UI 访问端口修改为 8888。接下来再申请一台CentOS7.9 的云主机，用于搭建gpmall 商城应用，并配置SkyWalking Agent， 将 gpmall 的 jar 包放置探针并启动。安装与配置完成后提交 skywalking 节点的用户名、密码和 IP 地址到答题框。</p>
<p>登录物理OpenStack平台，使用CentOS7.9镜像创建两台云主机（node-1，mall），云主机类型使用4VCPU/8GB内存/100GB硬盘。创建后的云主机作为本次案例的实验节点。</p>
<p>修改主机名</p>
<pre class="language-none"><code class="language-none">[root@node-1 ~]# hostnamectl set-hostname node-1
[root@node-1 ~]# hostnamectl
  Static hostname: node-1
        Icon name: computer-vm
          Chassis: vm
      Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa
          Boot ID: 6c32a0c1d29e4f30929422c8032239ca
  Virtualization: kvm
Operating System: CentOS Linux 7 (Core)
      CPE OS Name: cpe:/o:centos:centos:7
          Kernel: Linux 3.10.0-1160.el7.x86_64
    Architecture: x86-64</code></pre>
<p>将提供的elasticsearch-7.17.0-linux-x86_64.tar.gz软件包上传到此节点并解压到/opt目录，进入解压后的目录并创建data目录</p>
<pre class="language-none"><code class="language-none">[root@node-1 ~]# tar -zxvf elasticsearch-7.17.0-linux-x86_64.tar.gz -C /opt
[root@node-1 ~]# cd /opt/elasticsearch-7.17.0/
[root@node-1 elasticsearch-7.17.0]# mkdir data</code></pre>
<p>修改Elasticsearch配置，修改并添加如下几行内容</p>
<pre class="language-none"><code class="language-none">[root@node-1 elasticsearch-7.17.0]# vi config/elasticsearch.yml
…
cluster.name: my-application
node.name: node-1
path.data: /opt/elasticsearch-7.17.0/data
path.logs: /opt/elasticsearch-7.17.0/logs
network.host: 0.0.0.0
cluster.initial_master_nodes: ["node-1"]
…
http.cors.enabled: true
http.cors.allow-origin: "*"
http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</code></pre>
<p>创建Elasticsearch启动用户，并设置属组及权限</p>
<pre class="language-none"><code class="language-none">[root@node-1 elasticsearch-7.17.0]# groupadd elsearch
[root@node-1 elasticsearch-7.17.0]# useradd elsearch -g elsearch -p elasticsearch
[root@node-1 elasticsearch-7.17.0]# chown -R elsearch:elsearch /opt/elasticsearch-7.17.0</code></pre>
<p>修改资源限制及内核配置，添加如下内容</p>
<pre class="language-none"><code class="language-none">[root@node-1 elasticsearch-7.17.0]# vi /etc/security/limits.conf
…
* hard   nofile           65536
* soft   nofile           65536
[root@node-1 elasticsearch-7.17.0]# vi /etc/sysctl.conf
vm.max_map_count=262144
[root@node-1 elasticsearch-7.17.0]# sysctl -p
[root@node-1 elasticsearch-7.17.0]# reboot</code></pre>
<p>启动Elasticsearch服务</p>
<pre class="language-none"><code class="language-none">[root@node-1 ~]# cd /opt/elasticsearch-7.17.0/
[root@node-1 elasticsearch-7.17.0]# su elsearch
[elsearch@node-1 elasticsearch-7.17.0]$ ./bin/elasticsearch -d
按Ctrl+D退出</code></pre>
<p>查询端口，存在9200则成功启动</p>
<pre class="language-none"><code class="language-none">[root@node-1 elasticsearch-7.17.0]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address     Foreign Address       State       PID/Program name
tcp        0      0 0.0.0.0:22         0.0.0.0:*             LISTEN      1081/sshd      
tcp        0      0 127.0.0.1:25       0.0.0.0:*             LISTEN      1041/master    
tcp        0      0 0.0.0.0:111        0.0.0.0:*             LISTEN      610/rpcbind    
tcp6       0      0 :::9300           :::*                 LISTEN      2261/java      
tcp6       0      0 :::22             :::*                 LISTEN      1081/sshd      
tcp6       0      0 ::1:25             :::*                 LISTEN      1041/master    
tcp6       0      0 :::111             :::*                 LISTEN      610/rpcbind    
tcp6       0      0 :::9200           :::*                 LISTEN      2261/java</code></pre>


<p>使用提供的jdk-8u144-linux-x64.tar.gz软件包，上传jdk软件包，配置jdk如下</p>
<pre class="language-none"><code class="language-none">[root@node-1 ~]# tar -zxvf jdk-8u144-linux-x64.tar.gz -C /usr/local/
[root@node-1 ~]# vi /etc/profile
# /etc/profile
export JAVA_HOME=/usr/local/jdk1.8.0_144
export CLASSPATH=.:${JAVA_HOME}/jre/lib/rt.jar:${JAVA_HOME}/lib/dt.jar:${JAVA_HOME}/lib/tools.jar
export PATH=$PATH:${JAVA_HOME}/bin
…
[root@node-1 ~]# source /etc/profile
[root@node-1 ~]# java -version
java version "1.8.0_144"
Java(TM) SE Runtime Environment (build 1.8.0_144-b01)
Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</code></pre>
<p>进入解压后目录，修改OAP配置文件</p>
<pre class="language-none"><code class="language-none">[root@node-1 ~]# cd /opt/apache-skywalking-apm-bin-es7/
[root@node-1 apache-skywalking-apm-bin-es7]# vi config/application.yml
…
#集群配置使用单机版
cluster:
selector: ${SW_CLUSTER:standalone}
standalone:
…
#数据库使用elasticsearch7
storage:
selector: ${SW_STORAGE:elasticsearch7}
…
elasticsearch7:
  nameSpace: ${SW_NAMESPACE:""}
  clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:172.128.11.32:9200}</code></pre>

<p>启动OAP服务，查询端口，存在11800与12800则成功启动</p>
<pre class="language-none"><code class="language-none">[root@node-1 apache-skywalking-apm-bin-es7]# ./bin/oapService.sh
SkyWalking OAP started successfully!
[root@node-1 apache-skywalking-apm-bin-es7]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address       Foreign Address     State     PID/Program name
tcp        0      0 0.0.0.0:22           0.0.0.0:*           LISTEN     1081/sshd      
tcp        0      0 127.0.0.1:25         0.0.0.0:*           LISTEN     1041/master    
tcp        0      0 0.0.0.0:111          0.0.0.0:*           LISTEN     610/rpcbind    
tcp6       0      0 :::9300             :::*                 LISTEN     2261/java      
tcp6       0      0 :::22               :::*                 LISTEN     1081/sshd      
tcp6       0      0 :::11800             :::*                 LISTEN     2416/java      
tcp6       0      0 ::1:25               :::*                 LISTEN     1041/master    
tcp6       0      0 :::12800             :::*                 LISTEN     2416/java      
tcp6       0      0 :::111               :::*                 LISTEN     610/rpcbind    
tcp6       0      0 :::9200             :::*                 LISTEN     2261/java
</code></pre>

<p> 部署SkyWalking UI服务由于SkyWalking UI的默认地址是8080，与很多中间件可能存在冲突，修改一下</p>
<pre class="language-none"><code class="language-none">[root@node-1 apache-skywalking-apm-bin-es7]# vi webapp/webapp.yml
…
server:
port: 8888
…</code></pre>
<p>启动SkyWalking UI服务</p>
<pre class="language-none"><code class="language-none">[root@node-1 apache-skywalking-apm-bin-es7]# ./bin/webappService.sh
SkyWalking Web Application started successfully!</code></pre>
<p>查看端口，存在8888则成功启动</p>
<pre class="language-none"><code class="language-none">[root@node-1 apache-skywalking-apm-bin-es7]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address       Foreign Address     State       PID/Program name
tcp        0      0 0.0.0.0:22           0.0.0.0:*           LISTEN      1081/sshd      
tcp        0      0 127.0.0.1:25         0.0.0.0:*           LISTEN      1041/master    
tcp        0      0 0.0.0.0:111          0.0.0.0:*           LISTEN      610/rpcbind    
tcp6       0      0 :::9300             :::*               LISTEN      2261/java      
tcp6       0      0 :::22               :::*               LISTEN      1081/sshd      
tcp6       0      0 :::8888             :::*               LISTEN      3133/java      
tcp6       0      0 :::11800             :::*               LISTEN      2416/java      
tcp6       0      0 ::1:25               :::*               LISTEN      1041/master    
tcp6       0      0 :::12800             :::*               LISTEN      2416/java      
tcp6       0      0 :::111               :::*               LISTEN      610/rpcbind    
tcp6       0      0 :::9200             :::*               LISTEN      2261/java</code></pre>
<p>搭建并启动应用商城服务，并配置SkyWalking Agent修改mall节点主机名</p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# hostnamectl set-hostname mall
[root@mall ~]# hostnamectl
  Static hostname: mall
        Icon name: computer-vm
          Chassis: vm
      Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa
          Boot ID: 51559d155ec14aafad2411ca8b85db42
  Virtualization: kvm
Operating System: CentOS Linux 7 (Core)
      CPE OS Name: cpe:/o:centos:centos:7
          Kernel: Linux 3.10.0-1160.el7.x86_64
    Architecture: x86-64</code></pre>
<p>修改/etc/hosts配置文件如下</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

172.128.11.42 mal</code></pre>
<p>将提供的gpmall包上传到服务器的/root目录下并解压gpmall.tar.gz，配置本地local.repo文件</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# mv /etc/yum.repos.d/* /media/
[root@mall ~]# cd gpmall/
[root@mall gpmall]# tar -zxvf gpmall-repo.tar.gz -C /root/
[root@mall ~]# cat /etc/yum.repos.d/local.repo
[mall]
name=mall
baseurl=file:///root/gpmall-repo
gpgcheck=0
enabled=1</code></pre>
<p>安装基础服务，包括Java JDK环境、数据库、Redis、Nginx等</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel
...
[root@mall ~]# java -version
openjdk version "1.8.0_322"
OpenJDK Runtime Environment (build 1.8.0_322-b06)
OpenJDK 64-Bit Server VM (build 25.322-b06, mixed mode)
[root@mall ~]# yum install redis -y
[root@mall ~]# yum install nginx -y
[root@mall ~]# yum install mariadb mariadb-server -y
[root@mall ~]# tar -zxvf zookeeper-3.4.14.tar.gz

#进入到zookeeper-3.4.14/conf目录下，将zoo_sample.cfg文件重命名为zoo.cf

[root@mall ~]# cd zookeeper-3.4.14/conf/
[root@mall conf]# mv zoo_sample.cfg zoo.cfg
[root@mall conf]# cd ../bin
[root@mall bin]# ./zkServer.sh start
ZooKeeper JMX enabled by default
Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg
Starting zookeeper ... STARTED

#查看ZooKeeper状态

[root@mall bin]# ./zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg
Mode: standalone

安装Kafka服务，将提供的kafka_2.11-1.1.1.tgz包上传到mall节点上

[root@mall bin]# cd
[root@mall ~]# tar -zxvf kafka_2.11-1.1.1.tgz
[root@mall ~]# cd kafka_2.11-1.1.1/bin/
[root@mall bin]# ./kafka-server-start.sh -daemon ../config/server.properties
[root@mall bin]# jps
6039 Kafka
1722 QuorumPeerMain
6126 Jps
[root@mall bin]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address       Foreign Address     State       PID/Program name    
tcp        0      0 0.0.0.0:22           0.0.0.0:*           LISTEN      1008/sshd  
tcp        0      0 127.0.0.1:25         0.0.0.0:*           LISTEN      887/master  
tcp6       0      0 :::9092             :::*               LISTEN      6039/java  
tcp6       0      0 :::46949             :::*               LISTEN      6039/java  
tcp6       0      0 :::2181             :::*               LISTEN      1722/java  
tcp6       0      0 :::48677             :::*               LISTEN      1722/java  
tcp6       0      0 :::22               :::*               LISTEN      1008/sshd  
tcp6       0      0 ::1:25               :::*               LISTEN      887/master</code></pre>

<p>修改数据库配置文件并启动MariaDB数据库，设置root用户密码为123456，并创建gpmall数据库，将提供的gpmall.sql导入。</p>
<pre class="language-none"><code class="language-none">[root@mall bin]# cd
[root@mall ~]# vi /etc/my.cnf
[mysqld]
…
!includedir /etc/my.cnf.d
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake

[root@mall ~]# systemctl start mariadb</code></pre>
<p>设置root用户的权限，命令如下</p>
<pre class="language-none"><code class="language-none">MariaDB [(none)]&gt; grant all privileges on *.* to root@localhost identified by '123456' with grant option;
Query OK, 0 rows affected (0.001 sec)

MariaDB [(none)]&gt; grant all privileges on *.* to root@"%" identified by '123456' with grant option;
Query OK, 0 rows affected (0.001 sec)</code></pre>
<p>将gpmall.sql文件上传至云主机的/root目录下。创建数据库gpmall并导入gpmall.sql文件。</p>
<pre class="language-none"><code class="language-none">MariaDB [(none)]&gt; create database gpmall;
Query OK, 1 row affected (0.00 sec)
MariaDB [(none)]&gt; use gpmall;
MariaDB [gpmall]&gt; source /root/gpmall/gpmall.sql</code></pre>
<p>退出数据库并设置开机自启</p>
<pre class="language-none"><code class="language-none">MariaDB [gpmall]&gt; Ctrl-C -- exit!
Aborted
[root@mall ~]# systemctl enable mariadb
Created symlink from /etc/systemd/system/mysql.service to /usr/lib/systemd/system/mariadb.service.
Created symlink from /etc/systemd/system/mysqld.service to /usr/lib/systemd/system/mariadb.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.</code></pre>
<p>修改Redis配置文件，编辑/etc/redis.conf文件。<br>将bind 127.0.0.1这一行注释掉；将protected-mode yes 改为 protected-mode no。</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# vi /etc/redis.conf
…
#bind 127.0.0.1
protected-mode no
…
[root@mall ~]# systemctl start redis
[root@mall ~]# systemctl enable redis
Created symlink from /etc/systemd/system/multi-user.target.wants/redis.service to /usr/lib/systemd/system/redis.service.</code></pre>
<p>启动Nginx服务命令如下</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# systemctl start nginx
[root@mall ~]# systemctl enable nginx
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</code></pre>
<p>应用系统部署，使用提供gpmall-shopping-0.0.1-SNAPSHOT.jar、gpmall-user-0.0.1-SNAPSHOT.jar、shopping-provider-0.0.1-SNAPSHOT.jar、user-provider-0.0.1-SNAPSHOT.jar 、dist这5个包部署应用系统，其中4个jar包为后端服务包，dist为前端包。（包在gpmall目录下）<br>修改/etc/hosts文件，修改项目全局配置文件如下（原有的172.128.11.42 mall映射删除）</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
172.128.11.42 kafka.mall
172.128.11.42 mysql.mall
172.128.11.42 redis.mall
172.128.11.42 zookeeper.mall</code></pre>
<p>清空默认项目路径下的文件，将dist目录下的文件，复制到Nginx默认项目路径</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# rm -rf /usr/share/nginx/html/*
[root@mall ~]# cp -rvf gpmall/dist/* /usr/share/nginx/html/</code></pre>
<p>修改Nginx配置文件/etc/nginx/nginx.conf，添加映射如下所示</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# vi /etc/nginx/nginx.conf
…
  server {
      listen       80;
      listen       [::]:80;
      server_name _;
      root         /usr/share/nginx/html;

       # Load configuration files for the default server block.
      include /etc/nginx/default.d/*.conf;
       
      location / {
      root   /usr/share/nginx/html;
      index index.html index.htm;
      }
      location /user {
          proxy_pass http://127.0.0.1:8082;
      }

      location /shopping {
          proxy_pass http://127.0.0.1:8081;
      }

      location /cashier {
          proxy_pass http://127.0.0.1:8083;
      }

      error_page 404 /404.html;
…
[root@mall ~]# systemctl restart nginx</code></pre>
<p>到此，前端部署完毕。</p>
<p>部署后端</p>
<p>将node-1节点的/opt/apache-skywalking-apm-bin-es7目录下的agent目录复制到mall节点下：</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# scp -r 172.128.11.32:/opt/apache-skywalking-apm-bin-es7/agent /root

修改SkyWalking agent配置文件

[root@mall ~]# vi agent/config/agent.config
…
agent.service_name=${SW_AGENT_NAME:my-application}
agent.sample_n_per_3_secs=${SW_AGENT_SAMPLE:1}
…
collector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:172.128.11.32:11800}
…</code></pre>
<p>将提供的4个jar包上传到服务器的/root目录下，放置探针并启动，通过设置启动参数的方式检测系统，启动命令如下：</p>
<pre class="language-none"><code class="language-none">[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/shopping-provider-0.0.1-SNAPSHOT.jar &amp;
[1] 20086
[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’

[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/user-provider-0.0.1-SNAPSHOT.jar &amp;
[2] 20132
[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’

[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/gpmall-shopping-0.0.1-SNAPSHOT.jar &amp;
[3] 20177
[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’

[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/gpmall-user-0.0.1-SNAPSHOT.jar &amp;
[4] 20281
[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’
# httpd访问网络配置
[root@mall ~]# setsebool -P httpd_can_network_connect 1</code></pre>
<p>按照顺序运行4个jar包后，至此后端服务部署完毕<br>打开浏览器，在地址栏中输入<a target="_blank" rel="noopener" href="http://localhost,访问界面/">http://localhost，访问界面</a></p>
<p><img src="https://telegraph-image-7df.pages.dev/file/30a98de2c2134c858ade9.png" alt="商城首页"><br>单击右上角“头像”，进行登录操作，使用用户名/密码为test/test进行登录</p>
<p>1.检查 skywalking 服务部署正确计 1 分</p>
<h3 id="【题目-11】Linux-内核优化-1-分"><a href="#【题目-11】Linux-内核优化-1-分" class="headerlink" title="【题目 11】Linux 内核优化[1 分]"></a>【题目 11】Linux 内核优化[1 分]</h3><p>在使用 Linux 服务器的时候，TCP 协议规定，对于已经建立的连接，网络双方要进行四次挥手才能成功断开连接，如果缺少了其中某个步骤，将会使连接处于假死状态，连接本身占用的资源不会被释放。因为服务器程序要同时管理大量连接，所以很有必要保证无用的连接完全断开，否则大量僵死的连接会浪费许多服务器资源。创建一台 CentOS7.9 云主机，修改相应的配置文件，分别开启 SYN Cookies；允许将 TIME-WAIT sockets 重新用于新的 TCP 连接；开启TCP 连接中TIME-WAIT sockets 的快速回收；修改系統默认的 TIMEOUT 时间为 30。完成后提交修改节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysctl.conf</span>

<span class="token comment">#添加如下参数</span>
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">30</span>

<span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">30</span>
<span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment">#</span></code></pre>
<p>1.检查内核优化正确计 1 分</p>
<h3 id="【题目-12】排错：Glance-服务排错-1-分"><a href="#【题目-12】排错：Glance-服务排错-1-分" class="headerlink" title="【题目 12】排错：Glance 服务排错[1 分]"></a>【题目 12】排错：Glance 服务排错[1 分]</h3><p>使用赛项提供的 chinaskill-error1 镜像启动云主机，flavor 使用 4vcpu/12G 内存/100G 硬<br>盘。启动后存在错误的私有云平台，错误现象为查看不到 image 列表，试根据错误信息排查云平台错误，使云平台可以查询到 image 信息。完成后提交云主机节点的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">如果不会做，提供取巧思路~~
国赛是用错误镜像来创建一个云主机进行排错，可以试着修改正常经常的标签，然后创建正常的glance服务
可以得到部分分
</code></pre>

<p>1.检查错误镜像glance 服务启动正确计 1 分</p>
<h3 id="【题目-13】排错：数据库排错-1-5-分"><a href="#【题目-13】排错：数据库排错-1-5-分" class="headerlink" title="【题目 13】排错：数据库排错[1.5 分]"></a>【题目 13】排错：数据库排错[1.5 分]</h3><p>使用赛项提供的排错镜像 chinaskill-error2 创建一台云主机（云主机的登录用户名为 root， 密码为 000000），该云主机中存在错误的数据库服务，错误现象为数据库服务无法启动。请将数据库服务修复并启动，将数据库的密码修改为 chinaskill123。修复完成后提交该云主机的用户名、密码和 IP 地址到答题框。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">使用一个正常的mysql数据库，创建一个符合要求的用户和密码，可以得到0.5分~判分系统是先连接数据库
再进去查询</code></pre>

<p>1.检查错误镜像数据库服务启动正确计 1.5 分</p>
<h2 id="【任务-3】私有云运维开发-10-分"><a href="#【任务-3】私有云运维开发-10-分" class="headerlink" title="【任务 3】私有云运维开发[10 分]"></a>【任务 3】私有云运维开发[10 分]</h2><h3 id="【题目-1】Ansible-服务部署：部署-MariaDB-集群-2-分"><a href="#【题目-1】Ansible-服务部署：部署-MariaDB-集群-2-分" class="headerlink" title="【题目 1】Ansible 服务部署：部署 MariaDB 集群[2 分]"></a>【题目 1】Ansible 服务部署：部署 MariaDB 集群[2 分]</h3><p>使用OpenStack 私有云平台，创建 4 台系统为centos7.9 的云主机，其中一台作为 Ansible 的母机并命名为 ansible，另外三台云主机命名为 node1、node2、node3；使用这一台母机， 编写 Ansible 脚本（在/root 目录下创建 example 目录作为 Ansible 工作目录，部署的入口文件命名为 cscc_install.yaml ） ， 对其他三台云主机进行安装高可用数据库集群<br>（MariaDB_Galera_cluster，数据库密码设置为 123456）的操作（所需的安装包在 HTTP 服务中）。完成后提交 Ansible 节点的用户名、密码和 IP 地址到答题框。（考试系统会连接到你的Ansible 节点，去执行 Ansible 脚本，请准备好 Ansible 运行环境，以便考试系统访问）</p>
<p>（1）环境准备</p>
<table>
<thead>
<tr>
<th>节点</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>ansible</td>
<td>192.168.100.10</td>
</tr>
<tr>
<td>node1</td>
<td>192.168.100.20</td>
</tr>
<tr>
<td>node2</td>
<td>192.168.100.30</td>
</tr>
<tr>
<td>node3</td>
<td>192.168.100.40</td>
</tr>
</tbody></table>
<p>（2）环境配置</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname ansible</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname node1</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su</span>
<span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname node2</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su</span>
<span class="token punctuation">[</span>root@node2 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname node3</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su</span>
<span class="token punctuation">[</span>root@node3 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 将ip地址映射成主机名(其他3台节点配置一样,此处省略)</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/hosts</span>
<span class="token number">192.168</span>.100.10 ansible
<span class="token number">192.168</span>.100.20 node1
<span class="token number">192.168</span>.100.30 node2
<span class="token number">192.168</span>.100.40 node3
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token comment">#关闭防火墙和selinux(其他3台节点配置一样,此处省略)</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld &amp;&amp; setenforce 0</span>


<span class="token comment"># ansible节点部署ansible服务(通过CRT远程工具将提供的ansible软件包上传到ansible节点)</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># tar -xvf ansible.tar.gz</span>

<span class="token comment">#删除centos自带的源并配置本地yum源安装ansible服务</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># mv /etc/yum.repos.d/* /home/</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/yum.repos.d/local.repo</span>
<span class="token punctuation">[</span>ansible<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>ansible
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///root/ansible
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># yum install ansible -y</span>

<span class="token comment">#检查是否安装完成</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># ansible --version</span>
ansible <span class="token number">2.9</span>.10
  config <span class="token function">file</span> <span class="token operator">=</span> /etc/ansible/ansible.cfg
  configured module search path <span class="token operator">=</span> <span class="token punctuation">[</span>u<span class="token string">'/root/.ansible/plugins/modules'</span>, u<span class="token string">'/usr/share/ansible/plugins/modules'</span><span class="token punctuation">]</span>
  ansible python module location <span class="token operator">=</span> /usr/lib/python2.7/site-packages/ansible
  executable location <span class="token operator">=</span> /usr/bin/ansible
  python version <span class="token operator">=</span> <span class="token number">2.7</span>.5 <span class="token punctuation">(</span>default, Oct <span class="token number">14</span> <span class="token number">2020</span>, <span class="token number">14</span>:45:30<span class="token punctuation">)</span> <span class="token punctuation">[</span>GCC <span class="token number">4.8</span>.5 <span class="token number">20150623</span> <span class="token punctuation">(</span>Red Hat <span class="token number">4.8</span>.5-44<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<p>（3）设置免密</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen</span>
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>: 
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:svV0oqhTRNGB/tH37Xi49/OUg+AFu2XlxcKhsyXm+wI root@ansible
The key<span class="token string">'s randomart image is:
+---[RSA 2048]----+
|      .+..    .  |
|      o .    o o |
|     o   . .= +.o|
|      o . .o+=o..|
|     ...S.o++= o |
|      .=.+Eo*.o o|
|     .o . .+.. *.|
|    ..      ..oo=|
|    ..       .o+*|
+----[SHA256]-----+


[root@ansible ~]# ssh-copy-id root@node1
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host '</span>node1 <span class="token punctuation">(</span><span class="token number">192.168</span>.100.20<span class="token punctuation">)</span><span class="token string">' can'</span>t be established.
ECDSA key fingerprint is SHA256:sGY4R7darwNovS7pGeQNm9FzQjanFFmnwJHO5PRo0RE.
ECDSA key fingerprint is MD5:fa:5d:85:af:69:0d:63:78:ac:4e:9a:5b:c1:a6:b2:60.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
/usr/bin/ssh-copy-id: INFO: attempting to log <span class="token keyword">in</span> with the new key<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: <span class="token number">1</span> key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed -- <span class="token keyword">if</span> you are prompted now it is to <span class="token function">install</span> the new keys
root@node1<span class="token string">'s password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '</span>root@node1<span class="token string">'"
and check to make sure that only the key(s) you wanted were added.


[root@ansible ~]# ssh-copy-id root@node2
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host '</span>node2 <span class="token punctuation">(</span><span class="token number">192.168</span>.100.30<span class="token punctuation">)</span><span class="token string">' can'</span>t be established.
ECDSA key fingerprint is SHA256:sGY4R7darwNovS7pGeQNm9FzQjanFFmnwJHO5PRo0RE.
ECDSA key fingerprint is MD5:fa:5d:85:af:69:0d:63:78:ac:4e:9a:5b:c1:a6:b2:60.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
/usr/bin/ssh-copy-id: INFO: attempting to log <span class="token keyword">in</span> with the new key<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: <span class="token number">1</span> key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed -- <span class="token keyword">if</span> you are prompted now it is to <span class="token function">install</span> the new keys
root@node2<span class="token string">'s password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '</span>root@node2<span class="token string">'"
and check to make sure that only the key(s) you wanted were added.


[root@ansible ~]# ssh-copy-id root@node3
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host '</span>node3 <span class="token punctuation">(</span><span class="token number">192.168</span>.100.40<span class="token punctuation">)</span><span class="token string">' can'</span>t be established.
ECDSA key fingerprint is SHA256:sGY4R7darwNovS7pGeQNm9FzQjanFFmnwJHO5PRo0RE.
ECDSA key fingerprint is MD5:fa:5d:85:af:69:0d:63:78:ac:4e:9a:5b:c1:a6:b2:60.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
/usr/bin/ssh-copy-id: INFO: attempting to log <span class="token keyword">in</span> with the new key<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: <span class="token number">1</span> key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed -- <span class="token keyword">if</span> you are prompted now it is to <span class="token function">install</span> the new keys
root@node3<span class="token string">'s password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '</span>root@node3'"
and check to <span class="token function">make</span> sure that only the key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added.
</code></pre>

<p>（4）修改ansible文件配置组</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/ansible/hosts </span>
<span class="token punctuation">[</span>node<span class="token punctuation">]</span>
node1
node2
node3

<span class="token punctuation">[</span>node1<span class="token punctuation">]</span>
node1

<span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
node2

<span class="token punctuation">[</span>node3<span class="token punctuation">]</span>
node3


<span class="token comment">#解压mariadb.tar软件包将mariadb-repo源拷贝到node1,node2,node3节点的/root目录下</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># tar -xvf mariadb.tar </span>
mariadb/
mariadb/mariadb-repo.tar.gz
mariadb/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz
mariadb/schema.xml
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># tar -xvf mariadb/mariadb-repo.tar.gz </span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># scp -r mariadb-repo/ root@node1:/root</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># scp -r mariadb-repo/ root@node2:/root</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># scp -r mariadb-repo/ root@node3:/root</span></code></pre>

<p>（5）创建ansible执行的工作目录编写执行playbook剧本的相关文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># mkdir cscc_galera</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># cd cscc_galera/</span>


<span class="token comment">#创建local.repo文件</span>
<span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># vi local.repo</span>
<span class="token punctuation">[</span>centos<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>centos
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/centos   <span class="token comment">#自行挂载centos7.9镜像到/opt目录</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>mariadb<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>mariadb
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///root/mariadb-repo
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">#创建server.cnf文件</span>
<span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># vi server.cnf</span>
<span class="token punctuation">[</span>server<span class="token punctuation">]</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token punctuation">[</span>galera<span class="token punctuation">]</span>
<span class="token assign-left variable">wsrep_on</span><span class="token operator">=</span>ON
<span class="token assign-left variable">wsrep_provider</span><span class="token operator">=</span>/usr/lib64/galera/libgalera_smm.so
<span class="token assign-left variable">wsrep_cluster_address</span><span class="token operator">=</span>gcomm://node1,node2,node3
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>row
<span class="token assign-left variable">default_storage_engine</span><span class="token operator">=</span>InnoDB
<span class="token assign-left variable">innodb_autoinc_lock_mode</span><span class="token operator">=</span><span class="token number">2</span>
bind-address<span class="token operator">=</span><span class="token number">0.0</span>.0.0
<span class="token assign-left variable">wsrep_slave_threads</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">innodb_flush_log_at_trx_commit</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>embedded<span class="token punctuation">]</span>
<span class="token punctuation">[</span>mariadb<span class="token punctuation">]</span>
<span class="token punctuation">[</span>mariadb-10.3<span class="token punctuation">]</span>

<span class="token comment">#创建playbook剧本文件</span>
<span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># vi install_galera.yaml</span>
---
- hosts: all
  remote_user: root
  tasks:
  - name: <span class="token function">rm</span> repo
    shell: <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/yum.repos.d/* 
  - name: copy repo
    copy: <span class="token assign-left variable">src</span><span class="token operator">=</span>local.repo <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/yum.repos.d/
  - name: <span class="token function">install</span> mariadb
    yum: <span class="token assign-left variable">name</span><span class="token operator">=</span>mariadb-server
  - name: start mariadb
    service: <span class="token assign-left variable">name</span><span class="token operator">=</span>mariadb <span class="token assign-left variable">state</span><span class="token operator">=</span>started <span class="token assign-left variable">enabled</span><span class="token operator">=</span>yes
  - name: init_mysql
    shell: mysqladmin <span class="token parameter variable">-uroot</span> password <span class="token number">123456</span>
  - name: stop mariadb
    service: <span class="token assign-left variable">name</span><span class="token operator">=</span>mariadb <span class="token assign-left variable">state</span><span class="token operator">=</span>stopped
  - name: copy server.cnf
    copy: <span class="token assign-left variable">src</span><span class="token operator">=</span>server.cnf <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/my.cnf.d/server.cnf
- hosts: node1
  remote_user: root
  tasks:
  - name: start mariadb
    shell: /usr/sbin/mysqld --wsrep-new-cluster <span class="token parameter variable">-u</span> root <span class="token operator">&amp;</span>
- hosts: node2,node3
  remote_user: root
  tasks:
  - name: start mariadb
    shell: systemctl start mariadb
</code></pre>
<p>（6）执行入口文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># ansible-playbook install_galera.yaml </span>
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: Found both group and <span class="token function">host</span> with same name: node1
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: Found both group and <span class="token function">host</span> with same name: node3
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: Found both group and <span class="token function">host</span> with same name: node2

PLAY <span class="token punctuation">[</span>all<span class="token punctuation">]</span> *******************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> *******************************************************************************************
ok: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>rm repo<span class="token punctuation">]</span> ***************************************************************************************************
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: Consider using the <span class="token function">file</span> module with <span class="token assign-left variable">state</span><span class="token operator">=</span>absent rather than running <span class="token string">'rm'</span><span class="token builtin class-name">.</span>  If you need to use <span class="token builtin class-name">command</span>
because <span class="token function">file</span> is insufficient you can <span class="token function">add</span> <span class="token string">'warn: false'</span> to this <span class="token builtin class-name">command</span> task or <span class="token builtin class-name">set</span> <span class="token string">'command_warnings=False'</span> <span class="token keyword">in</span>
ansible.cfg to get rid of this message.
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>copy repo<span class="token punctuation">]</span> *************************************************************************************************
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>install mariadb<span class="token punctuation">]</span> *******************************************************************************************
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start mariadb<span class="token punctuation">]</span> *********************************************************************************************
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>init_mysql<span class="token punctuation">]</span> ************************************************************************************************
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>stop mariadb<span class="token punctuation">]</span> **********************************************************************************************
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>copy server.cnf<span class="token punctuation">]</span> **********************************************************************************************
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

PLAY <span class="token punctuation">[</span>node1<span class="token punctuation">]</span> *****************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> *******************************************************************************************
ok: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start mariadb<span class="token punctuation">]</span> *********************************************************************************************
changed: <span class="token punctuation">[</span>node1<span class="token punctuation">]</span>

PLAY <span class="token punctuation">[</span>node2,node3<span class="token punctuation">]</span> ***********************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> *******************************************************************************************
ok: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start mariadb<span class="token punctuation">]</span> *********************************************************************************************
changed: <span class="token punctuation">[</span>node2<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span>node3<span class="token punctuation">]</span>

PLAY RECAP *******************************************************************************************************
node1                      <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">9</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">7</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
node2                      <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">9</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">7</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
node3                      <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">9</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">7</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

<span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># </span></code></pre>
<p>（7）验证,检查wsrep_cluster_size的值是否为3/wsrep_ready的状态是否为ON</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ansible cscc_galera<span class="token punctuation">]</span><span class="token comment"># ssh node1</span>
Last login: Fri Aug <span class="token number">26</span> 05:01:52 <span class="token number">2022</span> from <span class="token number">192.168</span>.100.1
<span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">10</span>
Server version: <span class="token number">10.3</span>.23-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> show status like <span class="token string">'wsrep_cluster_size'</span><span class="token punctuation">;</span>
+--------------------+-------+
<span class="token operator">|</span> Variable_name      <span class="token operator">|</span> Value <span class="token operator">|</span>
+--------------------+-------+
<span class="token operator">|</span> wsrep_cluster_size <span class="token operator">|</span> <span class="token number">3</span>     <span class="token operator">|</span>
+--------------------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> show status like <span class="token string">'wsrep_ready'</span><span class="token punctuation">;</span>
+---------------+-------+
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> Value <span class="token operator">|</span>
+---------------+-------+
<span class="token operator">|</span> wsrep_ready   <span class="token operator">|</span> ON    <span class="token operator">|</span>
+---------------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> </code></pre>


<p>1.执行yaml 文件正确计 0.5 分<br>2.检查数据库集群部署正确计 1 分<br>3.检查数据库集群数量为 3 正确计 0.5 分</p>
<h3 id="【题目-2】Ansible-服务部署：部署ELK-集群服务-2-分"><a href="#【题目-2】Ansible-服务部署：部署ELK-集群服务-2-分" class="headerlink" title="【题目 2】Ansible 服务部署：部署ELK 集群服务[2 分]"></a>【题目 2】Ansible 服务部署：部署ELK 集群服务[2 分]</h3><p>使用赛项提供的OpenStack 私有云平台，创建三台 CentOS7.9 系统的云主机分别命名为elk-1、elk-2 和elk-3，Ansible 主机可以使用上一题的环境。要求Ansible 节点编写剧本，执行 Ansible 剧本可以在这三个节点部署 ELK 集群服务（在/root 目录下创建 install_elk 目录作为 ansible 工作目录，部署的入口文件命名为 install_elk.yaml）。具体要求为三个节点均安装Elasticserach 服务并配置为 Elasticserach 集群；kibana 安装在第一个节点；Logstash 安装在第二个节点。（需要用到的软件包在 HTTP 服务下）完成后提交 ansible 节点的用户名、密码和 IP 地址到答题框。（考试系统会连接到 ansible 节点，执行 ansible 脚本，准备好环境， 以便考试系统访问）</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">参考学习地址

https://www.likecs.com/show-307196346.html</code></pre>
<p>1.执行yaml 文件正确计 0.5 分<br>2.检查 ELK 服务部署正确计 1.5 分</p>
<h3 id="【题目-3】Python-运维开发：基于OpenStack-Restful-API-实现镜像上传-1-分"><a href="#【题目-3】Python-运维开发：基于OpenStack-Restful-API-实现镜像上传-1-分" class="headerlink" title="【题目 3】Python 运维开发：基于OpenStack Restful API 实现镜像上传[1 分]"></a>【题目 3】Python 运维开发：基于OpenStack Restful API 实现镜像上传[1 分]</h3><p>使用OpenStack all-in-one 镜像，创建 OpenStack Python 运维开发环境。云主机的用户/ 密码为：“root/Abc@1234”，OpenStack 的域名/账号/密码为：“demo/admin/000000”。<br>提示说明：python 脚本文件头建议加入“#encoding:utf-8”避免编码错误；测试脚本代码用 python3 命令执行与测试。<br>在 controller 节点的/root 目录下创建 api_image_manager.py 脚本，编写 python 代码对接OpenStack API，完成镜像的创建与上传。创建之前查询是否存在“同名镜像”，如果存在先删除该镜像。<br>（1）创建镜像：要求在 OpenStack 私有云平台中上传镜像cirros-0.3.4-x86_64-disk.img，名字为 cirros001，disk_format 为 qcow2，container_format 为bare。<br>（2）查询镜像：查询 cirros001 的详细信息，并以 json 格式文本输出到控制台。<br>完成后提交 OpenStack Python 运维开发环境Controller 节点的 IP 地址，用户名和密码提交。</p>
<p>（1）基础环境准备，安装python3，已经需要的依赖</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ controller ~<span class="token punctuation">]</span><span class="token comment"># python3 --version</span>
Python <span class="token number">3.6</span>.8

<span class="token comment">#使用提供的whl文件安装依赖</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cd Python-api</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  pip3 install certifi-2019.11.28-py2.py3-none-any.whl</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip3 install urllib3-1.25.11-py3-none-any.whl</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  pip3 install idna-2.8-py2.py3-none-any.whl</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  pip3 install chardet-3.0.4-py2.py3-none-any.whl</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#  pip3 install requests-2.24.0-py2.py3-none-any.whl</span>
</code></pre>
<p>（2）代码实现</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi api_image_manager.py</span>

<span class="token comment">#encoding:utf-8  </span>
<span class="token function">import</span> requests, json, <span class="token function">time</span>  
<span class="token function">import</span> logging  
<span class="token comment"># -----------logger-----------  </span>
<span class="token comment"># get logger  </span>
logger <span class="token operator">=</span> logging.getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>  
<span class="token comment"># level  </span>
logger.setLevel<span class="token punctuation">(</span>logging.DEBUG<span class="token punctuation">)</span>  
<span class="token comment"># format  </span>
<span class="token function">format</span> <span class="token operator">=</span> logging.Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s %(message)s'</span><span class="token punctuation">)</span>  
<span class="token comment"># to console  </span>
stream_handler <span class="token operator">=</span> logging.StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>  
stream_handler.setFormatter<span class="token punctuation">(</span>format<span class="token punctuation">)</span>  
logger.addHandler<span class="token punctuation">(</span>stream_handler<span class="token punctuation">)</span>  
<span class="token comment"># -----------logger-----------  </span>
def get_auth_token<span class="token punctuation">(</span>controller_ip, domain, user, password<span class="token punctuation">)</span>:  
   <span class="token string">''</span>'  
  :param controller_ip: openstack master <span class="token function">ip</span> address  
  :param domain: current user<span class="token string">'s domain  
  :param user: user name  
  :param password: user password  
  :return: keystoen auth Token for current user.  
   '</span>'<span class="token string">'  
  try:  
      url = f"http://{controller_ip}:5000/v3/auth/tokens"  
      body = {  
           "auth": {  
               "identity": {  
                   "methods": [  
                       "password"  
                  ],  
                   "password": {  
                       "user": {  
                           "domain": {  
                               "name": domain  
                          },  
                           "name": user,  
                           "password": password  
                      }  
                  }  
              },  
               "scope": {  
                   "project": {  
                       "domain": {  
                           "name": domain  
                      },  
                       "name": user  
                  }  
              }  
          }  
      }  
      headers = {  
           "Content-Type": "application/json",  
      }  
      print(body)  
      Token = requests.post(url, data=json.dumps(body), headers=headers).headers['</span>X-Subject-Token<span class="token string">']  
      headers = {  
           "X-Auth-Token": Token  
      }  
      logger.debug(f"获取Token值：{str(Token)}")  
      return headers  
  except Exception as e:  
      logger.error(f"获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：{str(e)}")  
       exit(0)  
# 镜像管理  
class image_manager:  
  def __init__(self, handers: dict, resUrl: str):  
      self.headers = handers  
      self.resUrl = resUrl  
   #POST v2/images  
  def create_image(self, image_name: str, container_format="bare", disk_format="qcow2"):  
       """  
      :param image_name:  
      :param container_format:  
      :param disk_format:  
      :return:  
       """  
      body = {  
           "container_format": container_format,  
           "disk_format": disk_format,  
           "name": image_name  
      }  
      response = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers)  
      logger.debug(response.status_code)  
       if response.status_code == 201:  
          return {"ImageItemCreatedSuccess": response.status_code}  
      return response.text  
   # 获取glance镜像id  
  def get_image_id(self, image_name: str):  
      result = json.loads(requests.get(self.resUrl, headers=self.headers).text)  
      logger.debug(result)  
       for item in result['</span>images<span class="token string">']:  
           if (item['</span>name<span class="token string">'] == image_name):  
              return item['</span><span class="token function">id</span><span class="token string">']  
   # 上传glance镜像  
   # Image data¶ Uploads and downloads raw image data.  
   # These operations may be restricted to administrators. Consult your cloud operator’s documentation for details.  
   # /v2/images/{image_id}/file  
   # 镜像可以重名  
  def upload_iamge_data(self, image_id: str, file_path=""):  
       """  
      :param image_id:  
      :param file_path:  
      :return:  
       """  
      self.resUrl = self.resUrl + "/" + image_id + "/file"  
      self.headers['</span>Content-Type<span class="token string">'] = "application/octet-stream"  
      response = requests.put(self.resUrl, data=open(file_path, '</span>rb<span class="token string">').read(), headers=self.headers)  
      logger.debug(response.status_code)  
       if response.status_code == 204:  
          return {"ImageItemCreatedSuccess": response.status_code}  
      return response.text  
   # ----------------------------  
   # /v2/images  
   # List images  
  def get_images(self):  
       """  
      :return:  
       """  
      status_code = requests.get(self.resUrl, headers=self.headers).text  
      logger.debug(f"返回状态:{str(status_code)}")  
      return status_code  
   # /v2/images/{image_id} Show image  
  def get_image(self, id: str):  
       """  
       get a flavor by id.  
      :return:  
       """  
      api_url = self.resUrl + "/" + id  
      response = requests.get(api_url, headers=self.headers)  
      result = json.loads(response.text)  
      logger.debug(f"返回信息:{str(result)}")  
      return result  
   # /v2/images/{image_id} Delete image  
  def delete_image(self, id: str):  
       """  
        delete a image by id.  
        :return:  
        """  
      api_url = self.resUrl + "/" + id  
      response = requests.delete(api_url, headers=self.headers)  
       # 204 - No ContentThe server has fulfilled the request.  
       if response.status_code == 204:  
          return {"Image itemDeletedSuccess": response.status_code}  
      result = json.loads(response.text)  
      logger.debug(f"返回信息:{str(result)}")  
      return result  
       # http://192.168.200.226:8774/v2.1/ get apis version infomation.  
if __name__ == '</span>__main__':  
   <span class="token comment"># 1. openstack allinone （controller ) credentials  </span>
   <span class="token comment"># host ip address  </span>
  controller_ip <span class="token operator">=</span> <span class="token string">"192.168.200.100"</span>  
   <span class="token comment"># domain name  </span>
  domain <span class="token operator">=</span> <span class="token string">"demo"</span>  
   <span class="token comment"># user name  </span>
  user <span class="token operator">=</span> <span class="token string">"admin"</span>  
   <span class="token comment"># user password  </span>
  password <span class="token operator">=</span> <span class="token string">"000000"</span>  
  headers <span class="token operator">=</span> get_auth_token<span class="token punctuation">(</span>controller_ip, domain, user, password<span class="token punctuation">)</span>  
  print<span class="token punctuation">(</span><span class="token string">"headers:"</span>, headers<span class="token punctuation">)</span>  
  <span class="token comment"># http://controller:9292  </span>
  image_m <span class="token operator">=</span> image_manager<span class="token punctuation">(</span>headers, f<span class="token string">"http://{controller_ip}:9292/v2/images"</span><span class="token punctuation">)</span>  
   <span class="token comment"># 1 查所有  </span>
  images <span class="token operator">=</span> image_m.get_images<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  print<span class="token punctuation">(</span><span class="token string">"查询所有images:"</span>, images<span class="token punctuation">)</span>  
   <span class="token comment">#2 创建镜像（注意，镜像允许同名）  </span>
  result <span class="token operator">=</span> image_m.create_image<span class="token punctuation">(</span>image_name<span class="token operator">=</span><span class="token string">"cirros001"</span><span class="token punctuation">)</span>  <span class="token comment"># 调用glance-api中创建镜像方法  </span>
  print<span class="token punctuation">(</span>f<span class="token string">"创建cirros001 镜像:"</span>, result<span class="token punctuation">)</span>  
   <span class="token comment">#   #1.1查询id  </span>
  <span class="token function">id</span> <span class="token operator">=</span> image_m.get_image_id<span class="token punctuation">(</span>image_name<span class="token operator">=</span><span class="token string">"cirros001"</span><span class="token punctuation">)</span>  
  print<span class="token punctuation">(</span><span class="token string">"cirros002镜像的，id为: "</span>, <span class="token function">id</span><span class="token punctuation">)</span>  
   <span class="token comment"># 1.2 上传镜像文件  </span>
  result <span class="token operator">=</span> image_m.upload_iamge_data<span class="token punctuation">(</span>id, <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"cirros-0.3.4-x86_64-disk.img"</span><span class="token punctuation">)</span>  
  print<span class="token punctuation">(</span>f<span class="token string">"上传{id}镜像:"</span>, result<span class="token punctuation">)</span>  
</code></pre>

<blockquote>
<p>需要修改的所有变量信息全部都在  if <strong>name</strong> == ‘<strong>main</strong>‘:    下面</p>
</blockquote>
<p>1.执行api_image_manager.py 脚本,成功创建镜像，计 0.5 分<br>2.检查镜像状态正确，计 0.5 分</p>
<h3 id="【题目-4】Python-运维开发：基于-Openstack-Python-SDK-实现云主机创建-1-分"><a href="#【题目-4】Python-运维开发：基于-Openstack-Python-SDK-实现云主机创建-1-分" class="headerlink" title="【题目 4】Python 运维开发：基于 Openstack Python SDK 实现云主机创建[1 分]"></a>【题目 4】Python 运维开发：基于 Openstack Python SDK 实现云主机创建[1 分]</h3><p>使 用 已 建 好 的 OpenStack Python 运 维 开 发 环 境 ，在 /root 目 录 下 创 建sdk_server_manager.py 脚本，使用 python-openstacksdk Python 模块，完成云主机的创建和查询。创建之前查询是否存在“同名云主机”，如果存在先删除该镜像。<br>（1）创建 1 台云主机：云主机信息如下： 云主机名称如下：server001<br>镜像文件：cirros-0.3.4-x86_64-disk.img 云主机类型：m1.tiny<br>网络等必要信息自己补充。<br>（2）查询云主机：查询云主机 server001 的详细信息，并以 json 格式文本输出到控制台。<br>完成后提交 OpenStack Python 运维开发环境 Controller 节点的 IP 地址，用户名和密码提交。</p>
<p>（1）代码实现<br>创建云主机所需的镜像、类型、网络是用name来识别的，需要提前创建好</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@container ~<span class="token punctuation">]</span><span class="token comment"># vi sdk_server_manager.py</span>

<span class="token function">import</span> json,logging  
<span class="token function">import</span> openstack  
<span class="token comment">#openstack logger  </span>
<span class="token comment"># openstack.enable_logging(debug=True)  </span>
<span class="token comment">#文档地址  </span>
<span class="token comment"># https://docs.openstack.org/openstacksdk/latest/user/index.html  </span>
def create_connection<span class="token punctuation">(</span>auth_url, user_domain_name, username, password<span class="token punctuation">)</span>:  
   <span class="token string">""</span>"  
  建立连接  
  :param auth_url:  
  :param user_domain_name:  
  :param username:  
  :param password:  
  :return:  
  <span class="token string">""</span>"  
   <span class="token builtin class-name">return</span> openstack.connect<span class="token punctuation">(</span>  
       <span class="token assign-left variable">auth_url</span><span class="token operator">=</span>auth_url,  
       <span class="token assign-left variable">user_domain_name</span><span class="token operator">=</span>user_domain_name,  
       <span class="token assign-left variable">username</span><span class="token operator">=</span>username,  
       <span class="token assign-left variable">password</span><span class="token operator">=</span>password,  
  <span class="token punctuation">)</span>  
<span class="token comment">#user Manager  </span>
<span class="token comment"># 参见文档  </span>
<span class="token comment"># https://docs.openstack.org/openstacksdk/latest/user/guides/identity.html  </span>
<span class="token comment">#openstack.connection.Connection  </span>
<span class="token comment">#云主机管理  </span>
class server_manager:  
   def __init__<span class="token punctuation">(</span>self, connect<span class="token punctuation">)</span>:  
       self.connect <span class="token operator">=</span> connect  
   def list_servers<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      查询所有云主机.  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       items <span class="token operator">=</span> self.connect.compute.servers<span class="token punctuation">(</span><span class="token punctuation">)</span>  
       server_jsons <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
       <span class="token keyword">for</span> <span class="token for-or-select variable">server</span> <span class="token keyword">in</span> items:  
           server_jsons<span class="token punctuation">[</span>server<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> server  
       <span class="token comment"># return ""  </span>
       <span class="token builtin class-name">return</span> items<span class="token comment"># json.dumps(server_jsons,indent=2,skipkeys=True)  </span>
   def create_server<span class="token punctuation">(</span>self, server_name, image_name, flavor_name,networ_name<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      create a server.  
      :param server_name:  
      :param image_name:  
      :param flavor_name:  
      :param networ_name:  
      :return:  
      <span class="token string">""</span>"  
       image <span class="token operator">=</span> self.connect.compute.find_image<span class="token punctuation">(</span>image_name<span class="token punctuation">)</span>  
       flavor <span class="token operator">=</span> self.connect.compute.find_flavor<span class="token punctuation">(</span>flavor_name<span class="token punctuation">)</span>  
       network <span class="token operator">=</span> self.connect.network.find_network<span class="token punctuation">(</span>networ_name<span class="token punctuation">)</span>  
       server <span class="token operator">=</span> self.connect.compute.create_server<span class="token punctuation">(</span>  
           <span class="token assign-left variable">name</span><span class="token operator">=</span>server_name, <span class="token assign-left variable">image_id</span><span class="token operator">=</span>image.id, <span class="token assign-left variable">flavor_id</span><span class="token operator">=</span>flavor.id,  
           <span class="token assign-left variable">networks</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"uuid"</span><span class="token builtin class-name">:</span> network.id<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
       result <span class="token operator">=</span> self.connect.compute.wait_for_server<span class="token punctuation">(</span>server<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> result <span class="token comment">#json.dumps(result,indent=2,skipkeys=True)  </span>
   def delete_server<span class="token punctuation">(</span>self, server_name<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      删除云主机  
      :param server_name:  
      :return:  
      <span class="token string">""</span>"  
       server <span class="token operator">=</span> self.connect.compute.find_server<span class="token punctuation">(</span>server_name<span class="token punctuation">)</span>  
       result <span class="token operator">=</span> self.connect.compute.delete_server<span class="token punctuation">(</span>server<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> result <span class="token comment">#json.dumps(result, indent=2, skipkeys=True)  </span>
   def get_server<span class="token punctuation">(</span>self, server_name<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      获取云主机  
      :param server_name:  
      :return:  
      <span class="token string">""</span>"  
       server <span class="token operator">=</span> self.connect.compute.find_server<span class="token punctuation">(</span>server_name<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>server, <span class="token assign-left variable">indent</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">skipkeys</span><span class="token operator">=</span>True<span class="token punctuation">)</span>  
class image_manager:  
   def __init__<span class="token punctuation">(</span>self, connect<span class="token punctuation">)</span>:  
       self.connect <span class="token operator">=</span> connect  
   def list_images<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      查询所有镜像  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       items <span class="token operator">=</span> self.connect.compute.images<span class="token punctuation">(</span><span class="token punctuation">)</span>  
       images_jsons <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
       <span class="token keyword">for</span> <span class="token for-or-select variable">image</span> <span class="token keyword">in</span> items:  
           images_jsons<span class="token punctuation">[</span>image<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> image  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>images_jsons,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
   def get_image<span class="token punctuation">(</span>self, image_name:str<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      查询镜像  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       image <span class="token operator">=</span> self.connect.compute.find_image<span class="token punctuation">(</span>image_name<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>image,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
class flavor_manager:  
   def __init__<span class="token punctuation">(</span>self, connect<span class="token punctuation">)</span>:  
       self.connect <span class="token operator">=</span> connect  
   def list_flavors<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      查询所有云主机类型  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       items <span class="token operator">=</span> self.connect.compute.flavors<span class="token punctuation">(</span><span class="token punctuation">)</span>  
       flavors_jsons <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
       <span class="token keyword">for</span> <span class="token for-or-select variable">flavor</span> <span class="token keyword">in</span> items:  
           flavors_jsons<span class="token punctuation">[</span>flavor<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> flavor  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>flavors_jsons,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
   def get_flavor<span class="token punctuation">(</span>self, flavor_name:str<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      根据名称获取云主机类.  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       flavor <span class="token operator">=</span> self.connect.compute.find_flavor<span class="token punctuation">(</span>flavor_name<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>flavor,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
class network_manager:  
   def __init__<span class="token punctuation">(</span>self, connect<span class="token punctuation">)</span>:  
       self.connect <span class="token operator">=</span> connect  
   def list_networks<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      查询所有网络.  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       items <span class="token operator">=</span> self.connect.network.networks<span class="token punctuation">(</span><span class="token punctuation">)</span>  
       items_jsons <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
       <span class="token keyword">for</span> <span class="token for-or-select variable">network</span> <span class="token keyword">in</span> items:  
           items_jsons<span class="token punctuation">[</span>network<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> network  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>items_jsons,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
   def get_network<span class="token punctuation">(</span>self, network_name:str<span class="token punctuation">)</span>:  
       <span class="token string">""</span>"  
      跟名称查询网络.  
      :return:  
      <span class="token string">""</span>"  
       <span class="token comment">#to json  </span>
       flavor <span class="token operator">=</span> self.connect.compute.find_network<span class="token punctuation">(</span>network_name<span class="token punctuation">)</span>  
       <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>flavor,indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>  
   <span class="token comment"># Initialize connection(通过配置文件）  </span>
   auth_url <span class="token operator">=</span> <span class="token string">"http://192.168.200.100:5000/v3/"</span>  
   username <span class="token operator">=</span> <span class="token string">"admin"</span>  
   password <span class="token operator">=</span> <span class="token string">"000000"</span>  
   user_domain_name <span class="token operator">=</span> <span class="token string">'demo'</span>  
   conn <span class="token operator">=</span> create_connection<span class="token punctuation">(</span>auth_url, user_domain_name, username, password<span class="token punctuation">)</span>  
   <span class="token comment"># 1 查询flavors  </span>
   print<span class="token punctuation">(</span><span class="token string">"list flavors--------"</span><span class="token punctuation">)</span>  
   sdk_m <span class="token operator">=</span> flavor_manager<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  
   flavors <span class="token operator">=</span> sdk_m.list_flavors<span class="token punctuation">(</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"flavors:"</span>, flavors<span class="token punctuation">)</span>  
   <span class="token comment"># 2 镜像管理  </span>
   sdk_m <span class="token operator">=</span> image_manager<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  
   items <span class="token operator">=</span> sdk_m.list_images<span class="token punctuation">(</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"image:"</span>, items<span class="token punctuation">)</span>  
   <span class="token comment"># 3 网络管理  </span>
   print<span class="token punctuation">(</span><span class="token string">"list networks--------"</span><span class="token punctuation">)</span>  
   sdk_m <span class="token operator">=</span> network_manager<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  
   networks <span class="token operator">=</span> sdk_m.list_networks<span class="token punctuation">(</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"networks:"</span>, networks<span class="token punctuation">)</span>  
   <span class="token comment">#4 查询 云主机  </span>
   sdk_m <span class="token operator">=</span> server_manager<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  
   servers <span class="token operator">=</span> sdk_m.list_servers<span class="token punctuation">(</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"servers:"</span>, servers<span class="token punctuation">)</span>  
   <span class="token comment">#5 创建云主机  </span>
   print<span class="token punctuation">(</span><span class="token string">"creat server--------"</span><span class="token punctuation">)</span>  
   servers <span class="token operator">=</span> sdk_m.create_server<span class="token punctuation">(</span><span class="token string">"server001"</span>,<span class="token string">"cirros"</span>,<span class="token string">"m1.tiny"</span>,<span class="token string">"net"</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"servers:"</span>, servers<span class="token punctuation">)</span>  
   <span class="token comment">#6 删除云主机  </span>
   result <span class="token operator">=</span> sdk_m.delete_server<span class="token punctuation">(</span><span class="token string">"test_song"</span><span class="token punctuation">)</span>  
   print<span class="token punctuation">(</span><span class="token string">"servers:"</span>, result<span class="token punctuation">)</span>  
</code></pre>
<p>1.执行 sdk_server_manager.py 脚本,成功创建云主机，计 0.5 分<br>2.检查创建的云主机状态正确，计 0.5 分</p>
<h3 id="【题目-5】Python-运维开发：云主机类型管理的命令行工具开发-2-分"><a href="#【题目-5】Python-运维开发：云主机类型管理的命令行工具开发-2-分" class="headerlink" title="【题目 5】Python 运维开发：云主机类型管理的命令行工具开发[2 分]"></a>【题目 5】Python 运维开发：云主机类型管理的命令行工具开发[2 分]</h3><p>使用已建好的 OpenStack Python 运维开发环境，在/root 目录下创建 flavor_manager.py<br>脚本，完成云主机类型的管理，flavor_manager.py 程序支持命令行参数执行。提示说明：Python 标准库argparse 模块，可以提供命令行参数的解析。要求如下：<br>（1）程序支持根据命令行参数，创建 1 个多云主机类型。返回 response。位置参数“create”，表示创建；<br>参数“-n”支持指定 flavor 名称，数据类型为字符串类型； 参数“-m”支持指定内存大小，数据类型为 int，单位 M； 参数“-v”支持指定虚拟 cpu 个数，数据类型为 int；<br>参数“-d”支持磁盘大小，内存大小类型为 int，单位 G； 参数“-id”支持指定 ID，类型为字符串。<br>参考运行实例：<br>python3 flavor_manager.py create -n flavor_small -m 1024 -v 1 -d 10 -id 100000</p>
<p>（2）程序支持查询目前 admin 账号下所有的云主机类型。位置参数“getall”，表示查询所有云主机类型；<br>查询结果，以 json 格式输出到控制台。参考执行实例如下：<br>python3 flavor_manager.py getall</p>
<p>（3）支持查询给定具体名称的云主机类型查询。位置参数“get”，表示查询 1 个云主机类型； 参数“-id”支持指定 ID 查询，类型为 string。 控制台以 json 格式输出创建结果。<br>参考执行实例如下：<br>python3 flavor_manager.py get -id 100000</p>
<p>（4）支持删除指定的 ID 云主机类型。<br>位置参数“delete”，表示删除一个云主机类型；<br>参数“-id”支持指定 ID 查询，返回 response，控制台输出response。参考执行实例如下：<br>python3 flavor_manager.py delete -id 100001</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">在这里插入代码片</code></pre>

<p>1.执行 flavor_manager.py 脚本，指定 create 和配置参数，成功创建 1 个云主机类型，计 0.5<br>分；<br>2.执行 flavor_manager.py 脚本，指定 getall 参数，成功查询所有云主机类型，计 0.5 分；<br>3.执行 flavor_manager.py 脚本，指定 get 和配置参数，成功查询具体名称的云主机类型，计<br>0.5 分；<br>4.执行 flavor_manager.py 脚本，指定 delete 和配置参数，成功删除指定 ID 云主机类型，计<br>0.5 分。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> json,openstack,argparse

class flavor_manager:
    def __init__<span class="token punctuation">(</span>self,auth_url,user_domain_name,username,password<span class="token punctuation">)</span>:
        self.connect <span class="token operator">=</span> openstack.connect<span class="token punctuation">(</span>
            <span class="token assign-left variable">auth_url</span><span class="token operator">=</span>auth_url,
            <span class="token assign-left variable">user_domain_name</span><span class="token operator">=</span>user_domain_name,
            <span class="token assign-left variable">username</span><span class="token operator">=</span>username,
            <span class="token assign-left variable">password</span><span class="token operator">=</span>password
        <span class="token punctuation">)</span>

    def create_flavor<span class="token punctuation">(</span>self,args<span class="token punctuation">)</span>:
        flavor <span class="token operator">=</span> self.connect.compute.find_flavor<span class="token punctuation">(</span>args.n<span class="token punctuation">)</span>
        <span class="token keyword">if</span> flavor is not None:
            self.connect.compute.delete_flavor<span class="token punctuation">(</span>flavor<span class="token punctuation">)</span>
        flavor <span class="token operator">=</span> self.connect.compute.create_flavor<span class="token punctuation">(</span>
            <span class="token assign-left variable">name</span><span class="token operator">=</span>args.n,
            <span class="token assign-left variable">vcpus</span><span class="token operator">=</span>args.v,
            <span class="token assign-left variable">ram</span><span class="token operator">=</span>args.m,
            <span class="token assign-left variable">disk</span><span class="token operator">=</span>args.d,
            <span class="token assign-left variable">id</span><span class="token operator">=</span>args.id
        <span class="token punctuation">)</span>
        <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>flavor<span class="token punctuation">)</span>

    def list_all_flavor<span class="token punctuation">(</span>self,args<span class="token punctuation">)</span>:
        flavors <span class="token operator">=</span> self.connect.compute.flavors<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">flavor</span> <span class="token keyword">in</span> flavors:
            print<span class="token punctuation">(</span>json.dumps<span class="token punctuation">(</span>flavor<span class="token punctuation">))</span>

    def get_flavor_by_id<span class="token punctuation">(</span>self,args<span class="token punctuation">)</span>:
        flavor <span class="token operator">=</span> self.connect.compute.find_flavor<span class="token punctuation">(</span>args.id<span class="token punctuation">)</span>
        <span class="token builtin class-name">return</span> json.dumps<span class="token punctuation">(</span>flavor<span class="token punctuation">)</span>

    def delete_flavor_by_id<span class="token punctuation">(</span>self,args<span class="token punctuation">)</span>:
        self.connect.compute.delete_flavor<span class="token punctuation">(</span>args.id<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    flavor_m <span class="token operator">=</span> flavor_manager<span class="token punctuation">(</span>
        <span class="token string">'http://192.168.73.10:5000/v3'</span>,
        <span class="token string">'demo'</span>,
        <span class="token string">'admin'</span>,
        <span class="token string">'000000'</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># 命令解析器</span>
    parser <span class="token operator">=</span> argparse.ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    subparsers <span class="token operator">=</span> parser.add_subparsers<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 添加子命令解析器</span>
    <span class="token comment"># create 子命令</span>
    parser_create <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'create'</span>,help<span class="token operator">=</span><span class="token string">"创建云主机类型"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-n'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str,help<span class="token operator">=</span><span class="token string">"支持指定 flavor 名称，数据类型为字符串类型"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-m'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>int,help<span class="token operator">=</span><span class="token string">"支持指定内存大小，数据类型为 int，单位 M"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-v'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>int,help<span class="token operator">=</span><span class="token string">"支持指定虚拟 cpu 个数，数据类型为 int"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-d'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>int,help<span class="token operator">=</span><span class="token string">"支持磁盘大小，内存大小类型为 int，单位 G"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-id'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str,help<span class="token operator">=</span><span class="token string">"支持指定 ID，类型为字符串"</span><span class="token punctuation">)</span>
    parser_create.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>flavor_m.create_flavor<span class="token punctuation">)</span>
    <span class="token comment"># getall 子命令</span>
    parser_getall <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">"getall"</span>,help<span class="token operator">=</span><span class="token string">"查询目前账号下所有的云主机类型"</span><span class="token punctuation">)</span>
    parser_getall.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>flavor_m.list_all_flavor<span class="token punctuation">)</span>
    <span class="token comment"># get 子命令</span>
    parser_get <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'get'</span>,help<span class="token operator">=</span><span class="token string">"查询给定具体名称的云主机类型查询"</span><span class="token punctuation">)</span>
    parser_get.add_argument<span class="token punctuation">(</span><span class="token string">'-id'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str,help<span class="token operator">=</span><span class="token string">"支持指定 ID 查询，类型为 string"</span><span class="token punctuation">)</span>
    parser_get.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>flavor_m.get_flavor_by_id<span class="token punctuation">)</span>
    <span class="token comment"># delete子命令</span>
    parser_delete <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'delete'</span>,help<span class="token operator">=</span><span class="token string">"删除指定的 ID 的云主机类型"</span><span class="token punctuation">)</span>
    parser_delete.add_argument<span class="token punctuation">(</span><span class="token string">'-id'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str,help<span class="token operator">=</span><span class="token string">"指定 ID 查询"</span><span class="token punctuation">)</span>
    parser_delete.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>flavor_m.delete_flavor_by_id<span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser.parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>args.func<span class="token punctuation">(</span>args<span class="token punctuation">))</span>
</code></pre>

<h3 id="【题目-6】Python-运维开发：用户管理的命令行工具开发-2-分"><a href="#【题目-6】Python-运维开发：用户管理的命令行工具开发-2-分" class="headerlink" title="【题目 6】Python 运维开发：用户管理的命令行工具开发[2 分]"></a>【题目 6】Python 运维开发：用户管理的命令行工具开发[2 分]</h3><p>使用已建好的OpenStack Python 运维开发环境，在/root 目录下创建 user_manager.py 脚本，完成用户管理功能开发，user_manager.py 程序支持命令行带参数执行。<br>提示说明：Python 标准库argparse 模块，可以提供命令行参数的解析。</p>
<p>（1）程序支持根据命令行参数，创建 1 个用户。位置参数“create”，表示创建；<br>参数“-i 或–input”，格式为 json 格式文本用户数据。查询结果，以 json 格式输出到控制台。<br>参考执行实例如下：<br>python3 user_manager.py create –input ‘{ “name”: “user01”, “password”: “000000”, “description”: “description” } ‘</p>
<p>（2）支持查询给定具体名称的用户查询。<br>位置参数“get”，表示查询 1 个用户；<br>参数“-n 或 –name”支持指定名称查询，类型为 string。<br>参数“-o 或 output”支持查询该用户信息输出到文件，格式为json 格式。参考执行实例如下：<br>python3 user_manager.py get –name user01-o user.json</p>
<p>（3）程序支持查询目前 admin 账号下所有的用户。位置参数“getall”，表示查询所有用户；<br>参数“-o 或–output”支持输出到文件，格式为 yaml 格式。参考执行实例如下：<br>python3 user_manager.py getall -o openstack_all_user.yaml</p>
<p>（4）支持删除指定的名称的用户。<br>位置参数“delete”，表示删除一个用户；返回 response，通过控制台输出。参数“-n 或–name”支持指定名称查询，类型为 string。<br>参考执行实例如下：<br>python3 user_manager.py delete -name user01</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">在这里插入代码片</code></pre>
<p>1.执行user_manager.py 脚本，指定 create 和配置参数，成功创建 1 个用户，计 0.5 分；<br>2.执行user_manager.py 脚本，指定 get 和配置参数，成功查询具体名称的用户，计 0.5 分； 3.执行user_manager.py 脚本，指定 getall 和配置参数，成功查询 admin 账号下的所有用户， 计 0.5 分；<br>4.执行user_manager.py 脚本，指定 delete 和配置参数，成功删除指定名称的用户，计 0.5 分</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat user_manager.py </span>
<span class="token function">import</span> json, yaml, openstack, argparse

class UserManager:
    def __init__<span class="token punctuation">(</span>self, auth_url, user_domain_name, username, password<span class="token punctuation">)</span>:
        self.connect <span class="token operator">=</span> openstack.connect<span class="token punctuation">(</span>
            <span class="token assign-left variable">auth_url</span><span class="token operator">=</span>auth_url,
            <span class="token assign-left variable">user_domain_name</span><span class="token operator">=</span>user_domain_name,
            <span class="token assign-left variable">username</span><span class="token operator">=</span>username,
            <span class="token assign-left variable">password</span><span class="token operator">=</span>password
        <span class="token punctuation">)</span>

    def create_user<span class="token punctuation">(</span>self, args<span class="token punctuation">)</span>:
        user_info <span class="token operator">=</span> json.loads<span class="token punctuation">(</span>args.input<span class="token punctuation">)</span>  <span class="token comment"># 转换为对象</span>
        user <span class="token operator">=</span> self.connect.identity.create_user<span class="token punctuation">(</span>
            <span class="token assign-left variable">name</span><span class="token operator">=</span>user_info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>,
            <span class="token assign-left variable">password</span><span class="token operator">=</span>user_info<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>,
            <span class="token assign-left variable">description</span><span class="token operator">=</span>user_info<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        print<span class="token punctuation">(</span>json.dumps<span class="token punctuation">(</span>user<span class="token punctuation">))</span>

    def get_user<span class="token punctuation">(</span>self, args<span class="token punctuation">)</span>:
        user <span class="token operator">=</span> self.connect.identity.find_user<span class="token punctuation">(</span>args.name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> args.output is not None:
            output <span class="token operator">=</span> open<span class="token punctuation">(</span>str<span class="token punctuation">(</span>args.output<span class="token punctuation">)</span>, <span class="token string">'w'</span><span class="token punctuation">)</span>
            json.dump<span class="token punctuation">(</span>user, output<span class="token punctuation">)</span>
        else:
            print<span class="token punctuation">(</span>json.dumps<span class="token punctuation">(</span>user<span class="token punctuation">))</span>

    def list_all_user<span class="token punctuation">(</span>self, args<span class="token punctuation">)</span>:
        <span class="token function">users</span> <span class="token operator">=</span> self.connect.identity.users<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> args.output is not None:
            output <span class="token operator">=</span> open<span class="token punctuation">(</span>str<span class="token punctuation">(</span>args.output<span class="token punctuation">)</span>, <span class="token string">'w'</span><span class="token punctuation">)</span>
            yaml.safe_dump<span class="token punctuation">(</span>json.loads<span class="token punctuation">(</span>json.dumps<span class="token punctuation">(</span>list<span class="token punctuation">(</span>users<span class="token punctuation">))</span><span class="token punctuation">)</span>, output<span class="token punctuation">)</span>
        else:
            print<span class="token punctuation">(</span>json.dumps<span class="token punctuation">(</span>list<span class="token punctuation">(</span>users<span class="token punctuation">))</span><span class="token punctuation">)</span>

    def del_user<span class="token punctuation">(</span>self, args<span class="token punctuation">)</span>:
        user <span class="token operator">=</span> self.connect.identity.find_user<span class="token punctuation">(</span>args.name<span class="token punctuation">)</span>
        resp <span class="token operator">=</span> self.connect.identity.delete_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        print<span class="token punctuation">(</span>resp<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    user_m <span class="token operator">=</span> UserManager<span class="token punctuation">(</span>
        <span class="token string">'http://192.168.73.10:5000/v3'</span>,
        <span class="token string">'demo'</span>,
        <span class="token string">'admin'</span>,
        <span class="token string">'000000'</span>
    <span class="token punctuation">)</span>

    parser <span class="token operator">=</span> argparse.ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    subparsers <span class="token operator">=</span> parser.add_subparsers<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># create 子命令</span>
    parser_create <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">"create"</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"创建 1 个用户"</span><span class="token punctuation">)</span>
    parser_create.add_argument<span class="token punctuation">(</span><span class="token string">'-i'</span>, <span class="token string">'--input'</span>,type<span class="token operator">=</span>str,required<span class="token operator">=</span>True, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"参数“-i 或--input”，格式为 json 格式文本用户数据"</span><span class="token punctuation">)</span>
    parser_create.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>user_m.create_user<span class="token punctuation">)</span>
    <span class="token comment"># get 子命令</span>
    parser_get <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'get'</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"表示查询 1 个用户"</span><span class="token punctuation">)</span>
    parser_get.add_argument<span class="token punctuation">(</span><span class="token string">'-n'</span>, <span class="token string">'--name'</span>, <span class="token assign-left variable">required</span><span class="token operator">=</span>True, <span class="token assign-left variable">type</span><span class="token operator">=</span>str, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"参数“-n 或 --name”支持指定名称查询，类型为 string"</span><span class="token punctuation">)</span>
    parser_get.add_argument<span class="token punctuation">(</span><span class="token string">'-o'</span>, <span class="token string">'--output'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"参数“-o 或 output”支持查询该用户信息输出到文件，格式为 json 格式。"</span><span class="token punctuation">)</span>
    parser_get.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>user_m.get_user<span class="token punctuation">)</span>
    <span class="token comment"># getall子命令</span>
    parser_getll <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'getall'</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"目前账号下所有的用户"</span><span class="token punctuation">)</span>
    parser_getll.add_argument<span class="token punctuation">(</span><span class="token string">'-o'</span>, <span class="token string">'--output'</span>, <span class="token assign-left variable">type</span><span class="token operator">=</span>str, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"参数“-o 或--output”支持输出到文件，格式为 yaml 格式。"</span><span class="token punctuation">)</span>
    parser_getll.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>user_m.list_all_user<span class="token punctuation">)</span>
    <span class="token comment"># delete子命令</span>
    parser_delete <span class="token operator">=</span> subparsers.add_parser<span class="token punctuation">(</span><span class="token string">'delete'</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"表示删除一个用户"</span><span class="token punctuation">)</span>
    parser_delete.add_argument<span class="token punctuation">(</span><span class="token string">'-n'</span>, <span class="token string">'--name'</span>, <span class="token assign-left variable">required</span><span class="token operator">=</span>True, <span class="token assign-left variable">type</span><span class="token operator">=</span>str, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"参数“-n 或--name”支持指定名称查询，类型为 string"</span><span class="token punctuation">)</span>
    parser_delete.set_defaults<span class="token punctuation">(</span>func<span class="token operator">=</span>user_m.del_user<span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser.parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    args.func<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
</code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">I W</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://iwhig.github.io/2023/03/10/2022-yun-ji-suan-ji-neng-da-sai-si-you-yun/">https://iwhig.github.io/2023/03/10/2022-yun-ji-suan-ji-neng-da-sai-si-you-yun/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">I W</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                                <a href="/tags/Ansible/">
                                    <span class="chip bg-color">Ansible</span>
                                </a>
                            
                                <a href="/tags/Openstack/">
                                    <span class="chip bg-color">Openstack</span>
                                </a>
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                                <a href="/tags/SQL/">
                                    <span class="chip bg-color">SQL</span>
                                </a>
                            
                                <a href="/tags/Elasticsearch/">
                                    <span class="chip bg-color">Elasticsearch</span>
                                </a>
                            
                                <a href="/tags/Jumpserver/">
                                    <span class="chip bg-color">Jumpserver</span>
                                </a>
                            
                                <a href="/tags/Redis/">
                                    <span class="chip bg-color">Redis</span>
                                </a>
                            
                                <a href="/tags/Skywalking/">
                                    <span class="chip bg-color">Skywalking</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/03/10/io-diao-du-ce-lue-xiu-gai/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="I/O调度策略修改">
                        
                        <span class="card-title">I/O调度策略修改</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            I/O调度策略修改
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-03-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            IW
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/03/10/linux-xi-tong-ju-bing-you-hua/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="Linux系统句柄优化">
                        
                        <span class="card-title">Linux系统句柄优化</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Linux系统优化
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-03-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            IW
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023-2025</span>
            
            <a href="/about" target="_blank">I W</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">47.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/iwhig" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:zzjmcloud@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2632440423" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2632440423" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://iwhig.github.io"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
